
R version 2.15.3 (2013-03-01) -- "Security Blanket"
Copyright (C) 2013 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ####################################################
> # QURU MODEL Autogenic x Competition x (Temp x Precip) :
> # Autogenic: Size/Age logistic scalar with Max potential growth for absolute values
> # Competition: Relative Size, Plot BA Scalars
> # Climate: Jan-Dec
> #	-- Temp: Mean Jan-Dec, Gaussian
> #	-- Precip: Sum Jan-Dec + upslope flow, Gaussian
> #
> ####################################################
> rm(list=ls())
> 
> data_directory <- "~/CARCA/Growth-Models/Annual/"
> #memory.size(4024)
> setwd(data_directory)
> library(likelihood)
Loading required package: nlme
> 
> # run.label <- "QURU_Full_Ann"
> # load(file=paste( run.label, "_Results.Rdata", sep=""))
> 
> run.label <- "QURU_Full_Ann"
> 
> #############
> # Reading in Test Data & some formating
> all.data <-read.csv("../Raw Inputs/CARCA_CoreData_Climate_Annual.csv")
> all.data[,substr(names(all.data),1,4)=="Tavg"] <- all.data[,substr(names(all.data),1,4)=="Tavg"]+273.15
> all.data$BA.tree.cm2 <- all.data$BA.tree/100
> all.data$Site.Trans <- as.factor(substr(all.data$PlotID,1,4))
> summary(all.data)
      Year          PlotID        Site       Trans           Plot      
 Min.   :1771   HNKC2  :  8505   BLD:62694   A: 88452   Min.   :1.000  
 1st Qu.:1831   FLTA1  :  7776   FLT:49329   B: 93798   1st Qu.:1.000  
 Median :1892   HIKA1  :  7290   HIK:48357   C:106434   Median :2.000  
 Mean   :1892   HNKB2  :  7290   HNK:43983              Mean   :2.265  
 3rd Qu.:1953   HNKA3  :  7047   IRN:52245              3rd Qu.:3.000  
 Max.   :2013   BLDA2  :  6804   MOR:32076              Max.   :4.000  
                (Other):243972                                         
     TreeID            BAI                 CoreID       Pith      
 BLDA101:   243   Min.   :    0.00   BLDA101HI:   243   N:211896  
 BLDA102:   243   1st Qu.:   84.36   BLDA102HI:   243   Y: 76788  
 BLDA103:   243   Median :  244.79   BLDA103HI:   243             
 BLDA104:   243   Mean   :  459.83   BLDA104HI:   243             
 BLDA105:   243   3rd Qu.:  589.69   BLDA105HI:   243             
 BLDA106:   243   Max.   :18648.71   BLDA106HI:   243             
 (Other):287226   NA's   :202009     (Other)  :287226             
    Pith.Yr          Inner          Outer      Bark       Use       
 Min.   :1756    Min.   :1762   Min.   :1990   N:  6318   N:  4617  
 1st Qu.:1917    1st Qu.:1923   1st Qu.:2012   Y:282366   Y:284067  
 Median :1933    Median :1938   Median :2012                        
 Mean   :1936    Mean   :1939   Mean   :2012                        
 3rd Qu.:1953    3rd Qu.:1955   3rd Qu.:2012                        
 Max.   :2008    Max.   :2009   Max.   :2013                        
 NA's   :60021                                                      
                        Notes         Pith.offset         Tree      
 poor corr w/ master       :   972   Min.   : 0.00   Min.   : 1.00  
 poor correlation w/ master:   972   1st Qu.: 1.00   1st Qu.:10.00  
 1977 missing              :   486   Median : 2.00   Median :18.50  
 1986 missing              :   486   Mean   : 3.35   Mean   :20.86  
 1999 missing              :   486   3rd Qu.: 5.00   3rd Qu.:30.00  
 (Other)                   : 14094   Max.   :20.00   Max.   :84.00  
 NA's                      :271188   NA's   :60021                  
      Spp              Genus         Canopy         Live       
 ACRU   :71199   Quercus  :111294   C   :148230   DEAD:   243  
 QUPR   :50787   Acer     : 85779   D   :  8748   LIVE:288441  
 QURU   :43740   Nyssa    : 38880   I   : 86022                
 NYSY   :38880   Magnolia : 11421   U   : 45441                
 ACSA   :14580   Betula   :  8262   NA's:   243                
 MAAC   : 9720   Sassafras:  7776                              
 (Other):59778   (Other)  : 25272                              
      Age            BA.m2ha          BAI.filled          BA.tree      
 Min.   :  0.00   Min.   : 0.0000   Min.   :    0.00   Min.   :     0  
 1st Qu.: 19.00   1st Qu.: 0.0000   1st Qu.:    0.00   1st Qu.:     0  
 Median : 40.00   Median : 0.0000   Median :    0.00   Median :     0  
 Mean   : 44.55   Mean   : 0.1771   Mean   :  149.04   Mean   :  6106  
 3rd Qu.: 64.00   3rd Qu.: 0.0615   3rd Qu.:   74.84   3rd Qu.:  2007  
 Max.   :256.00   Max.   :11.8597   Max.   :18648.71   Max.   :462177  
 NA's   :195231   NA's   :1047      NA's   :985        NA's   :1047    
     Stems          Density.Ha     BAI.filled.plot      BA.plot       
 Min.   :0.0000   Min.   : 0.000   Min.   :    0.0   Min.   :    0.0  
 1st Qu.:0.0000   1st Qu.: 0.000   1st Qu.:    0.0   1st Qu.:    0.0  
 Median :0.0000   Median : 0.000   Median :  904.8   Median :  581.2  
 Mean   :0.3191   Mean   : 9.728   Mean   : 3899.5   Mean   : 2063.0  
 3rd Qu.:1.0000   3rd Qu.:31.831   3rd Qu.: 6247.5   3rd Qu.: 2866.9  
 Max.   :1.0000   Max.   :49.736   Max.   :38677.4   Max.   :23212.2  
                                   NA's   :1500      NA's   :1500     
  BA.m2ha.plot     Density.ha.plot     Stems.plot     BAI.m2ha.plot   
 Min.   : 0.0000   Min.   :   0.00   Min.   : 0.000   Min.   :0.0000  
 1st Qu.: 0.0000   1st Qu.:   0.00   1st Qu.: 0.000   1st Qu.:0.0000  
 Median : 0.0705   Median :  63.66   Median : 2.000   Median :0.0274  
 Mean   : 3.4704   Mean   : 268.53   Mean   : 8.898   Mean   :0.1135  
 3rd Qu.: 4.3534   3rd Qu.: 509.30   3rd Qu.:18.000   3rd Qu.:0.1935  
 Max.   :35.8804   Max.   :1432.39   Max.   :45.000   Max.   :1.0485  
 NA's   :1500      NA's   :1500      NA's   :1500     NA's   :1500    
 BA.m2ha.plot.live     RelBA          Site.Trans        Latitude     
 Min.   : 0.000    Min.   :0.00     BLDC   : 23814   Min.   :36.75   
 1st Qu.: 0.000    1st Qu.:0.05     IRNC   : 20898   1st Qu.:37.24   
 Median : 1.116    Median :0.17     HIKC   : 20169   Median :37.91   
 Mean   : 5.122    Mean   :0.30     BLDA   : 19926   Mean   :37.74   
 3rd Qu.: 6.584    3rd Qu.:0.46     BLDB   : 18954   3rd Qu.:38.32   
 Max.   :57.620    Max.   :1.00     IRNB   : 18711   Max.   :38.58   
 NA's   :985       NA's   :199115   (Other):166212   NA's   :153252  
   Longitude           elev             flow             TPI        
 Min.   :-81.31   Min.   : 666.9   Min.   :0.01     Min.   :-0.23   
 1st Qu.:-80.86   1st Qu.: 843.7   1st Qu.:0.01     1st Qu.:-0.10   
 Median :-79.85   Median : 952.4   Median :0.03     Median :-0.03   
 Mean   :-80.10   Mean   : 955.7   Mean   :0.12     Mean   : 0.01   
 3rd Qu.:-79.22   3rd Qu.:1098.3   3rd Qu.:0.06     3rd Qu.: 0.15   
 Max.   :-79.15   Max.   :1256.7   Max.   :1.42     Max.   : 0.30   
 NA's   :153252   NA's   :153252   NA's   :153252   NA's   :153252  
      sol            sol.lag          Anomaly            Tavg       
 Min.   : 90338   Min.   : 90338   Min.   :-1.48    Min.   :277.5   
 1st Qu.: 99340   1st Qu.: 99340   1st Qu.:-0.40    1st Qu.:281.6   
 Median :107050   Median :107050   Median : 0.01    Median :282.8   
 Mean   :110569   Mean   :110569   Mean   : 0.00    Mean   :282.5   
 3rd Qu.:121199   3rd Qu.:121199   3rd Qu.: 0.37    3rd Qu.:283.6   
 Max.   :133748   Max.   :133748   Max.   : 1.31    Max.   :285.8   
 NA's   :153252   NA's   :153252   NA's   :153252   NA's   :153252  
  Precip.PRISM      Tavg.PRISM     Precip.PRISM.sum  BA.tree.cm2     
 Min.   : 41.00   Min.   :281.3    Min.   : 492.0   Min.   :   0.00  
 1st Qu.: 81.45   1st Qu.:282.6    1st Qu.: 977.4   1st Qu.:   0.00  
 Median : 92.11   Median :283.2    Median :1105.4   Median :   0.00  
 Mean   : 93.52   Mean   :283.2    Mean   :1122.2   Mean   :  61.06  
 3rd Qu.:103.05   3rd Qu.:283.8    3rd Qu.:1236.7   3rd Qu.:  20.07  
 Max.   :152.72   Max.   :285.6    Max.   :1832.7   Max.   :4621.77  
 NA's   :154440   NA's   :261360   NA's   :154440   NA's   :1047     
> dim(all.data)
[1] 288684     49
> 
> #############
> # Subsetting just QURU data
> quru.all <- all.data[all.data$Spp=="QURU", ]
> summary(quru.all)
      Year          PlotID       Site       Trans          Plot      
 Min.   :1771   BLDA1  : 4860   BLD:15309   A:28917   Min.   :1.000  
 1st Qu.:1831   BLDA2  : 3645   FLT: 8262   B: 8262   1st Qu.:1.000  
 Median :1892   FLTA1  : 2673   HIK: 8505   C: 6561   Median :2.000  
 Mean   :1892   HIKA1  : 2430   HNK: 3402             Mean   :2.044  
 3rd Qu.:1953   HIKA2  : 2430   IRN: 6075             3rd Qu.:3.000  
 Max.   :2013   BLDA3  : 2187   MOR: 2187             Max.   :4.000  
                (Other):25515                                        
     TreeID           BAI               CoreID      Pith         Pith.Yr     
 BLDA101:  243   Min.   :   0.0   BLDA101HI:  243   N:37179   Min.   :1791   
 BLDA102:  243   1st Qu.: 300.2   BLDA102HI:  243   Y: 6561   1st Qu.:1916   
 BLDA103:  243   Median : 587.3   BLDA103HI:  243             Median :1932   
 BLDA104:  243   Mean   : 848.8   BLDA104HI:  243             Mean   :1928   
 BLDA105:  243   3rd Qu.:1075.1   BLDA105HI:  243             3rd Qu.:1936   
 BLDA106:  243   Max.   :9918.1   BLDA106HI:  243             Max.   :1979   
 (Other):42282   NA's   :29331    (Other)  :42282             NA's   :10206  
     Inner          Outer      Bark      Use      
 Min.   :1794   Min.   :2012   N:  486   N: 1215  
 1st Qu.:1924   1st Qu.:2012   Y:43254   Y:42525  
 Median :1936   Median :2012                      
 Mean   :1932   Mean   :2012                      
 3rd Qu.:1944   3rd Qu.:2012                      
 Max.   :1982   Max.   :2013                      
                                                  
                                                    Notes      
 poor correlation with master                          :  486  
 actually lo core, but this one measured because longer:  243  
 break at 1931, 2 missing rings                        :  243  
 cores reversed?                                       :  243  
 not sure of pith est                                  :  243  
 (Other)                                               : 1215  
 NA's                                                  :41067  
  Pith.offset          Tree            Spp             Genus       Canopy   
 Min.   : 1.000   Min.   : 1.00   QURU   :43740   Quercus :43740   C:35478  
 1st Qu.: 2.000   1st Qu.: 6.00   ACRU   :    0   Acer    :    0   D: 2673  
 Median : 4.000   Median :13.00   ACSA   :    0   Betula  :    0   I: 4617  
 Mean   : 5.043   Mean   :16.35   BELE   :    0   Carya   :    0   U:  972  
 3rd Qu.: 7.000   3rd Qu.:23.00   BEPA   :    0   Castanea:    0            
 Max.   :18.000   Max.   :68.00   CADE   :    0   Cornus  :    0            
 NA's   :10206                    (Other):    0   (Other) :    0            
   Live            Age            BA.m2ha         BAI.filled    
 DEAD:    0   Min.   :  0.00   Min.   :0.0000   Min.   :   0.0  
 LIVE:43740   1st Qu.: 21.00   1st Qu.:0.0000   1st Qu.:   0.0  
              Median : 43.00   Median :0.0000   Median :   0.0  
              Mean   : 46.39   Mean   :0.3264   Mean   : 301.4  
              3rd Qu.: 66.00   3rd Qu.:0.2355   3rd Qu.: 354.1  
              Max.   :221.00   Max.   :8.6278   Max.   :9918.1  
              NA's   :28081    NA's   :157      NA's   :146     
    BA.tree           Stems          Density.Ha    BAI.filled.plot  
 Min.   :     0   Min.   :0.0000   Min.   : 0.00   Min.   :    0.0  
 1st Qu.:     0   1st Qu.:0.0000   1st Qu.: 0.00   1st Qu.:    0.0  
 Median :     0   Median :0.0000   Median : 0.00   Median :  771.4  
 Mean   : 11887   Mean   :0.3569   Mean   :10.54   Mean   : 4288.4  
 3rd Qu.:  8197   3rd Qu.:1.0000   3rd Qu.:31.83   3rd Qu.: 7726.8  
 Max.   :462177   Max.   :1.0000   Max.   :49.74   Max.   :38677.4  
 NA's   :157                                       NA's   :60       
    BA.plot       BA.m2ha.plot      Density.ha.plot     Stems.plot    
 Min.   :    0   Min.   : 0.00000   Min.   :   0.00   Min.   : 0.000  
 1st Qu.:    0   1st Qu.: 0.00000   1st Qu.:   0.00   1st Qu.: 0.000  
 Median :  471   Median : 0.03597   Median :  56.59   Median : 2.000  
 Mean   : 2182   Mean   : 3.93044   Mean   : 238.22   Mean   : 8.236  
 3rd Qu.: 3059   3rd Qu.: 5.13052   3rd Qu.: 445.63   3rd Qu.:16.000  
 Max.   :23212   Max.   :35.88040   Max.   :1432.39   Max.   :45.000  
 NA's   :60      NA's   :60         NA's   :60        NA's   :60      
 BAI.m2ha.plot     BA.m2ha.plot.live     RelBA         Site.Trans   
 Min.   :0.00000   Min.   : 0.000    Min.   :0.000   BLDA   :12879  
 1st Qu.:0.00000   1st Qu.: 0.000    1st Qu.:0.177   HIKA   : 6804  
 Median :0.02069   Median : 1.020    Median :0.367   FLTA   : 3888  
 Mean   :0.11888   Mean   : 6.683    Mean   :0.440   IRNA   : 2916  
 3rd Qu.:0.23251   3rd Qu.: 8.984    3rd Qu.:0.673   FLTB   : 2187  
 Max.   :1.04853   Max.   :57.620    Max.   :1.000   FLTC   : 2187  
 NA's   :60        NA's   :146       NA's   :28578   (Other):12879  
    Latitude       Longitude           elev             flow      
 Min.   :36.75   Min.   :-81.31   Min.   : 666.9   Min.   :0.006  
 1st Qu.:37.24   1st Qu.:-80.86   1st Qu.:1001.9   1st Qu.:0.009  
 Median :37.92   Median :-79.85   Median :1098.3   Median :0.013  
 Mean   :37.78   Mean   :-80.07   Mean   :1048.8   Mean   :0.073  
 3rd Qu.:38.32   3rd Qu.:-79.24   3rd Qu.:1131.5   3rd Qu.:0.032  
 Max.   :38.57   Max.   :-79.15   Max.   :1256.7   Max.   :1.419  
 NA's   :23220   NA's   :23220    NA's   :23220    NA's   :23220  
      TPI              sol            sol.lag          Anomaly      
 Min.   :-0.234   Min.   : 90338   Min.   : 90338   Min.   :-1.477  
 1st Qu.:-0.030   1st Qu.:108006   1st Qu.:108006   1st Qu.:-0.398  
 Median : 0.145   Median :121199   Median :121199   Median : 0.009  
 Mean   : 0.094   Mean   :116674   Mean   :116674   Mean   :-0.003  
 3rd Qu.: 0.180   3rd Qu.:127447   3rd Qu.:127447   3rd Qu.: 0.369  
 Max.   : 0.300   Max.   :133748   Max.   :133748   Max.   : 1.308  
 NA's   :23220    NA's   :23220    NA's   :23220    NA's   :23220   
      Tavg        Precip.PRISM      Tavg.PRISM    Precip.PRISM.sum
 Min.   :277.6   Min.   : 41.00   Min.   :281.3   Min.   : 492.0  
 1st Qu.:282.1   1st Qu.: 83.23   1st Qu.:282.5   1st Qu.: 998.8  
 Median :282.8   Median : 93.12   Median :283.0   Median :1117.4  
 Mean   :282.6   Mean   : 94.33   Mean   :283.1   Mean   :1131.9  
 3rd Qu.:283.5   3rd Qu.:103.29   3rd Qu.:283.7   3rd Qu.:1239.5  
 Max.   :285.7   Max.   :152.72   Max.   :285.6   Max.   :1832.7  
 NA's   :23220   NA's   :23400    NA's   :39600   NA's   :23400   
  BA.tree.cm2     
 Min.   :   0.00  
 1st Qu.:   0.00  
 Median :   0.00  
 Mean   : 118.87  
 3rd Qu.:  81.97  
 Max.   :4621.77  
 NA's   :157      
> dim(quru.all)
[1] 43740    49
> 
> # Subsetting only complete cases & a small range of years
> quru.run <- quru.all[complete.cases(quru.all) & quru.all$Year>=1990 & quru.all$Year<=2011,]
> summary(quru.run)
      Year          PlotID    Site    Trans        Plot       TreeID  
 Min.   :1990   HIKA1  :44   BLD:44   A:132   Min.   :1   BLDA408:22  
 1st Qu.:1995   BLDA4  :22   FLT:22   B: 88   1st Qu.:1   BLDB210:22  
 Median :2000   BLDB2  :22   HIK:66   C:  0   Median :2   FLTB204:22  
 Mean   :2000   FLTB2  :22   HNK: 0           Mean   :2   HIKA112:22  
 3rd Qu.:2006   HIKA3  :22   IRN:66           3rd Qu.:3   HIKA124:22  
 Max.   :2011   IRNA1  :22   MOR:22           Max.   :4   HIKA311:22  
                (Other):66                                (Other):88  
      BAI                CoreID   Pith       Pith.Yr         Inner     
 Min.   :  11.57   BLDA408HI:22   N:154   Min.   :1833   Min.   :1838  
 1st Qu.:  91.45   BLDB210HI:22   Y: 66   1st Qu.:1914   1st Qu.:1916  
 Median : 537.28   FLTB204HI:22           Median :1924   Median :1928  
 Mean   : 910.43   HIKA112HI:22           Mean   :1923   Mean   :1927  
 3rd Qu.:1014.15   HIKA124HI:22           3rd Qu.:1953   3rd Qu.:1954  
 Max.   :5138.91   HIKA311HI:22           Max.   :1975   Max.   :1976  
                   (Other)  :88                                        
     Outer      Bark    Use                                Notes   
 Min.   :2012   N:  0   N:110   poor correlation with master  :44  
 1st Qu.:2012   Y:220   Y:110   break at 1931, 2 missing rings:22  
 Median :2012                   cores reversed?               :22  
 Mean   :2012                   not sure of pith est          :22  
 3rd Qu.:2012                   poor correlation              :22  
 Max.   :2013                   poor correlation w/ master    :22  
                                (Other)                       :66  
  Pith.offset      Tree         Spp           Genus     Canopy    Live    
 Min.   : 1   Min.   : 4   QURU   :220   Quercus :220   C:176   DEAD:  0  
 1st Qu.: 1   1st Qu.: 8   ACRU   :  0   Acer    :  0   D:  0   LIVE:220  
 Median : 2   Median :10   ACSA   :  0   Betula  :  0   I: 22             
 Mean   : 4   Mean   :14   BELE   :  0   Carya   :  0   U: 22             
 3rd Qu.: 5   3rd Qu.:12   BEPA   :  0   Castanea:  0                     
 Max.   :17   Max.   :47   CADE   :  0   Cornus  :  0                     
                           (Other):  0   (Other) :  0                     
      Age           BA.m2ha          BAI.filled         BA.tree      
 Min.   : 15.0   Min.   :0.03568   Min.   :  11.57   Min.   :  1121  
 1st Qu.: 48.0   1st Qu.:0.11861   1st Qu.:  91.45   1st Qu.:  3726  
 Median : 75.5   Median :0.72495   Median : 537.28   Median : 22776  
 Mean   : 77.8   Mean   :0.94233   Mean   : 910.43   Mean   : 53958  
 3rd Qu.: 93.0   3rd Qu.:1.27020   3rd Qu.:1014.15   3rd Qu.: 80750  
 Max.   :178.0   Max.   :4.00466   Max.   :5138.91   Max.   :283015  
                                                                     
     Stems     Density.Ha    BAI.filled.plot    BA.plot       BA.m2ha.plot   
 Min.   :1   Min.   :14.15   Min.   : 4550   Min.   : 3706   Min.   : 4.219  
 1st Qu.:1   1st Qu.:14.15   1st Qu.: 9549   1st Qu.: 6188   1st Qu.:11.185  
 Median :1   Median :31.83   Median :13870   Median : 8352   Median :17.440  
 Mean   :1   Mean   :26.53   Mean   :16168   Mean   :10950   Mean   :16.026  
 3rd Qu.:1   3rd Qu.:31.83   3rd Qu.:21686   3rd Qu.:18038   3rd Qu.:20.644  
 Max.   :1   Max.   :31.83   Max.   :38677   Max.   :22926   Max.   :25.384  
                                                                             
 Density.ha.plot    Stems.plot    BAI.m2ha.plot    BA.m2ha.plot.live
 Min.   : 183.9   Min.   : 9.00   Min.   :0.1448   Min.   : 6.075   
 1st Qu.: 537.6   1st Qu.:23.00   1st Qu.:0.2878   1st Qu.:16.930   
 Median : 748.0   Median :28.00   Median :0.3675   Median :23.833   
 Mean   : 694.7   Mean   :26.77   Mean   :0.3756   Mean   :25.277   
 3rd Qu.: 923.1   3rd Qu.:37.00   3rd Qu.:0.4420   3rd Qu.:29.255   
 Max.   :1177.7   Max.   :38.00   Max.   :0.8590   Max.   :57.383   
                                                                    
     RelBA           Site.Trans    Latitude       Longitude     
 Min.   :0.01735   HIKA   :66   Min.   :36.75   Min.   :-81.31  
 1st Qu.:0.06467   IRNA   :44   1st Qu.:36.76   1st Qu.:-81.31  
 Median :0.21439   BLDA   :22   Median :37.82   Median :-79.98  
 Mean   :0.23471   BLDB   :22   Mean   :37.68   Mean   :-80.21  
 3rd Qu.:0.35788   FLTB   :22   3rd Qu.:38.57   3rd Qu.:-79.17  
 Max.   :0.63988   IRNB   :22   Max.   :38.57   Max.   :-79.17  
                   (Other):22                                   
      elev             flow               TPI                sol        
 Min.   : 738.1   Min.   :0.007666   Min.   :-0.09616   Min.   : 90338  
 1st Qu.:1006.1   1st Qu.:0.007879   1st Qu.:-0.05699   1st Qu.:108006  
 Median :1098.4   Median :0.010878   Median : 0.14476   Median :112130  
 Mean   :1080.8   Mean   :0.038309   Mean   : 0.08025   Mean   :111369  
 3rd Qu.:1146.9   3rd Qu.:0.031593   3rd Qu.: 0.20568   3rd Qu.:119732  
 Max.   :1256.7   Max.   :0.237478   Max.   : 0.20998   Max.   :129249  
                                                                        
    sol.lag          Anomaly              Tavg        Precip.PRISM   
 Min.   : 90338   Min.   :-0.78176   Min.   :278.4   Min.   : 68.26  
 1st Qu.:108006   1st Qu.:-0.32481   1st Qu.:280.7   1st Qu.: 83.28  
 Median :112130   Median : 0.04472   Median :282.4   Median : 91.58  
 Mean   :111369   Mean   : 0.10365   Mean   :282.1   Mean   : 95.84  
 3rd Qu.:119732   3rd Qu.: 0.48712   3rd Qu.:283.4   3rd Qu.:106.07  
 Max.   :129249   Max.   : 1.12121   Max.   :284.8   Max.   :142.71  
                                                                     
   Tavg.PRISM    Precip.PRISM.sum  BA.tree.cm2     
 Min.   :281.3   Min.   : 819.1   Min.   :  11.21  
 1st Qu.:282.3   1st Qu.: 999.4   1st Qu.:  37.26  
 Median :282.8   Median :1099.0   Median : 227.76  
 Mean   :282.8   Mean   :1150.1   Mean   : 539.58  
 3rd Qu.:283.4   3rd Qu.:1272.9   3rd Qu.: 807.50  
 Max.   :285.0   Max.   :1712.6   Max.   :2830.15  
                                                   
> dim(quru.run)
[1] 220  49
> 
> write.csv(quru.run, "Inputs/QURU_AllSites_1990-2011.csv", row.names=F)
> 
> ################################################
> # Reading in Data
> quru.run <- read.csv("Inputs/QURU_AllSites_1990-2011.csv")
> summary(quru.run)
      Year          PlotID    Site    Trans        Plot       TreeID  
 Min.   :1990   HIKA1  :44   BLD:44   A:132   Min.   :1   BLDA408:22  
 1st Qu.:1995   BLDA4  :22   FLT:22   B: 88   1st Qu.:1   BLDB210:22  
 Median :2000   BLDB2  :22   HIK:66           Median :2   FLTB204:22  
 Mean   :2000   FLTB2  :22   IRN:66           Mean   :2   HIKA112:22  
 3rd Qu.:2006   HIKA3  :22   MOR:22           3rd Qu.:3   HIKA124:22  
 Max.   :2011   IRNA1  :22                    Max.   :4   HIKA311:22  
                (Other):66                                (Other):88  
      BAI                CoreID   Pith       Pith.Yr         Inner     
 Min.   :  11.57   BLDA408HI:22   N:154   Min.   :1833   Min.   :1838  
 1st Qu.:  91.45   BLDB210HI:22   Y: 66   1st Qu.:1914   1st Qu.:1916  
 Median : 537.28   FLTB204HI:22           Median :1924   Median :1928  
 Mean   : 910.43   HIKA112HI:22           Mean   :1923   Mean   :1927  
 3rd Qu.:1014.15   HIKA124HI:22           3rd Qu.:1953   3rd Qu.:1954  
 Max.   :5138.91   HIKA311HI:22           Max.   :1975   Max.   :1976  
                   (Other)  :88                                        
     Outer      Bark    Use                                Notes   
 Min.   :2012   Y:220   N:110   poor correlation with master  :44  
 1st Qu.:2012           Y:110   break at 1931, 2 missing rings:22  
 Median :2012                   cores reversed?               :22  
 Mean   :2012                   not sure of pith est          :22  
 3rd Qu.:2012                   poor correlation              :22  
 Max.   :2013                   poor correlation w/ master    :22  
                                (Other)                       :66  
  Pith.offset      Tree      Spp          Genus     Canopy    Live    
 Min.   : 1   Min.   : 4   QURU:220   Quercus:220   C:176   LIVE:220  
 1st Qu.: 1   1st Qu.: 8                            I: 22             
 Median : 2   Median :10                            U: 22             
 Mean   : 4   Mean   :14                                              
 3rd Qu.: 5   3rd Qu.:12                                              
 Max.   :17   Max.   :47                                              
                                                                      
      Age           BA.m2ha          BAI.filled         BA.tree      
 Min.   : 15.0   Min.   :0.03568   Min.   :  11.57   Min.   :  1121  
 1st Qu.: 48.0   1st Qu.:0.11861   1st Qu.:  91.45   1st Qu.:  3726  
 Median : 75.5   Median :0.72495   Median : 537.28   Median : 22776  
 Mean   : 77.8   Mean   :0.94233   Mean   : 910.43   Mean   : 53958  
 3rd Qu.: 93.0   3rd Qu.:1.27020   3rd Qu.:1014.15   3rd Qu.: 80750  
 Max.   :178.0   Max.   :4.00466   Max.   :5138.91   Max.   :283015  
                                                                     
     Stems     Density.Ha    BAI.filled.plot    BA.plot       BA.m2ha.plot   
 Min.   :1   Min.   :14.15   Min.   : 4550   Min.   : 3706   Min.   : 4.219  
 1st Qu.:1   1st Qu.:14.15   1st Qu.: 9549   1st Qu.: 6188   1st Qu.:11.185  
 Median :1   Median :31.83   Median :13870   Median : 8352   Median :17.440  
 Mean   :1   Mean   :26.53   Mean   :16168   Mean   :10950   Mean   :16.026  
 3rd Qu.:1   3rd Qu.:31.83   3rd Qu.:21686   3rd Qu.:18038   3rd Qu.:20.644  
 Max.   :1   Max.   :31.83   Max.   :38677   Max.   :22926   Max.   :25.384  
                                                                             
 Density.ha.plot    Stems.plot    BAI.m2ha.plot    BA.m2ha.plot.live
 Min.   : 183.9   Min.   : 9.00   Min.   :0.1448   Min.   : 6.075   
 1st Qu.: 537.6   1st Qu.:23.00   1st Qu.:0.2878   1st Qu.:16.930   
 Median : 748.0   Median :28.00   Median :0.3675   Median :23.833   
 Mean   : 694.7   Mean   :26.77   Mean   :0.3756   Mean   :25.277   
 3rd Qu.: 923.1   3rd Qu.:37.00   3rd Qu.:0.4420   3rd Qu.:29.255   
 Max.   :1177.7   Max.   :38.00   Max.   :0.8590   Max.   :57.383   
                                                                    
     RelBA         Site.Trans    Latitude       Longitude           elev       
 Min.   :0.01735   BLDA:22    Min.   :36.75   Min.   :-81.31   Min.   : 738.1  
 1st Qu.:0.06467   BLDB:22    1st Qu.:36.76   1st Qu.:-81.31   1st Qu.:1006.1  
 Median :0.21439   FLTB:22    Median :37.82   Median :-79.98   Median :1098.4  
 Mean   :0.23471   HIKA:66    Mean   :37.68   Mean   :-80.21   Mean   :1080.8  
 3rd Qu.:0.35788   IRNA:44    3rd Qu.:38.57   3rd Qu.:-79.17   3rd Qu.:1146.9  
 Max.   :0.63988   IRNB:22    Max.   :38.57   Max.   :-79.17   Max.   :1256.7  
                   MORB:22                                                     
      flow               TPI                sol            sol.lag      
 Min.   :0.007666   Min.   :-0.09616   Min.   : 90338   Min.   : 90338  
 1st Qu.:0.007879   1st Qu.:-0.05699   1st Qu.:108006   1st Qu.:108006  
 Median :0.010878   Median : 0.14476   Median :112130   Median :112130  
 Mean   :0.038309   Mean   : 0.08025   Mean   :111369   Mean   :111369  
 3rd Qu.:0.031593   3rd Qu.: 0.20568   3rd Qu.:119732   3rd Qu.:119732  
 Max.   :0.237478   Max.   : 0.20998   Max.   :129249   Max.   :129249  
                                                                        
    Anomaly              Tavg        Precip.PRISM      Tavg.PRISM   
 Min.   :-0.78176   Min.   :278.4   Min.   : 68.26   Min.   :281.3  
 1st Qu.:-0.32481   1st Qu.:280.7   1st Qu.: 83.28   1st Qu.:282.3  
 Median : 0.04472   Median :282.4   Median : 91.58   Median :282.8  
 Mean   : 0.10365   Mean   :282.1   Mean   : 95.84   Mean   :282.8  
 3rd Qu.: 0.48712   3rd Qu.:283.4   3rd Qu.:106.07   3rd Qu.:283.4  
 Max.   : 1.12121   Max.   :284.8   Max.   :142.71   Max.   :285.0  
                                                                    
 Precip.PRISM.sum  BA.tree.cm2     
 Min.   : 819.1   Min.   :  11.21  
 1st Qu.: 999.4   1st Qu.:  37.26  
 Median :1099.0   Median : 227.76  
 Mean   :1150.1   Mean   : 539.58  
 3rd Qu.:1272.9   3rd Qu.: 807.50  
 Max.   :1712.6   Max.   :2830.15  
                                   
> 
> # Loading previous runs
> #load(file="Test results for QURU 4 - All Sites 1990-2011.Rdata")
> 
> ####################################################################################################################
> overall.model <- function(
+ 							SIZE,aa,ab, gmax,             # Autogenic (a) -- ABSOLUTE UNITS (from gmax)
+                             BA.PLOT,RS,ca,cb,cc,cd,ce,cf,cg, # Competition (c) -- scalar
+                             # # BA.PLOT,RS,ca,cb,cc,cd,cf,cg, # Competition (c) -- scalar, removed intercept
+                             TEMP,ta1,tb1,					 # Temperature (t) -- scalar
+                             PRECIP,FLOW,pa1,pb1,pc1         	 # Preciptiation (p) -- scalar
+                             # TRANS, ha		             	 # Habitat (h) -- scalar
+                             )
+ 	{
+ 	################
+ 	# Autogenic Growth: 0-1 * gmax (max possible growth, absolute units)
+ 	################
+ 	autogenic.effect <- gmax*(1 - aa*exp(-ab*SIZE))   
+ 	# autogenic.effect <- gmax*(1-aa*exp(-ab*SIZE))   
+ 
+ 
+ 	################
+ 	# Competition Effect: 0-1 
+ 	################
+ 	size.effect <- ca*exp(-cb*(RS^cc))
+ 	comp.effect <- (ce/1000 + ( (1-ce/1000)/(1+(BA.PLOT/cf)^cg)))
+ 	# comp.effect <- (1/(1+(BA.PLOT/cf)^cg))
+ 	comp.response <- exp(-size.effect*(comp.effect^cd))
+ 
+  	################
+ 	# Climate Effect: Now Scalar
+ 	################
+ 	
+ 	#Temp on scale 0-1
+     temp.effect <- (exp(-0.5*(((TEMP)-ta1)/tb1)^2))
+ 
+     # Precip on scale 0-1
+     # precip.effect <- t(1/(1+(t(PRECIP)/pa1)^pb1))
+ 	precip.effect <- (exp(-0.5*(((PRECIP + pc1*FLOW*PRECIP)-pa1)/pb1)^2)) # Gaussian Data Frame
+ 
+ 	# Multiplying temp & precip together
+     climate.effect <- temp.effect * precip.effect
+ 	 
+ 	 ### LEM: do row sums
+ 	 ##### CRR note: I think this should be on a scale from 0-1; 
+      # climate.effect <- colSums(climate.effect) 
+ 	 # climate.effect2 <- apply(climate.effect, 1, FUN=prod)
+ 	
+ 
+ 	################
+ 	# Habitat Effect: 0-1
+ 	# Note: removed from model for the moment, may add Topographic position or upslope area later
+ 	################
+ 	# habitat.effect <- ha[TRANS]
+ 
+ 	# comp.response <- 1
+ 	habitat.effect <- 1
+ 	# climate.effect2 <- precip.effect
+ 
+ 	autogenic.effect*comp.response*habitat.effect*climate.effect
+ 	
+ 
+ 	}
> 
> 
> ####################################################################################################################
> ####################################################################################################################
> ### setting up annealing
> 
> # par <- results$best_par
> 
> # need a list that gives initial values for all of the "parameters"
> par<-list(
+ 		  aa=0.92, ab=0.013, gmax=10000,  	# Autogenic
+           ca=1957, cb=150, cc=5, cd=2.2, ce=38.7, cf=43, cg=-453,  # Competition
+           ta1=286, tb1=3.8,
+           pa1=4250, pb1=2412, pc1=0.92,
+           # # ha=rep(0.5,3),  # Habitat
+           sd=591)
> 
> # also need a list that identifies the independent variables
> var <- list(SIZE = "BA.tree.cm2",  # Autogenic
+             BA.PLOT="BA.m2ha.plot.live", RS="RelBA",  # Competition
+             TEMP = "Tavg", # hard-coded above
+             PRECIP = "Precip.PRISM.sum", FLOW="flow"
+             # TRANS="Site.Trans" # Habitat
+             )
> 
> ## Set bounds and initial search ranges within which to search for parameters
> ##   NOTE:  the s and sd parameters have to be greater than zero (algebraically)
> par_lo <-list(
+ 			  aa=0, ab=0, gmax=0,  # Autogenic
+               ca=0, cb=0, cc=0, cd=0, ce=0, cf=-100, cg=-1000, # Competition
+               # # ca=0, cb=0, cc=0, cd=0, cf=-100, cg=-200, # Competition
+               ta1=250, tb1=0,
+               pa1=100, pb1=0, pc1=0,
+ 			# ha=rep(0,3), # Habitat
+               sd=0.1)
> 
> 
> par_hi <-list(
+ 			  aa=1, ab=1000, gmax=10000, # Autogenic
+               ca=2000, cb=1000, cc=5, cd=5, ce=1000, cf=2000, cg=1000,	# Competition
+               # # ca=1000, cb=1000, cc=50, cd=5, cf=500, cg=1000,	# Competition
+               ta1=325, tb1=500,
+               pa1=5000, pb1=10000, pc1=1,
+               # ha=rep(1,3), # Habitat
+               sd=1000)
> 
> ## Specify the dependent variable, and name it using whatever
> ##    argument name is used in the pdf ("x" in the normal.pdf function above)
> var$x<-"BAI"
> 
> ## predicted value in your PDF should be given the reserved name "predicted"
> ##   Anneal will use your scientific model and your data and calculate the
> ##   predicted value for each observation and store it internally in an object
> ##   called "predicted"
> var$mean<-"predicted"
> 
> ## Have it calculate log likelihood
> var$log<-TRUE
> 
> ##  now call the annealing algorithm, choosing which model to use
> #  "data" should be whatever the name of your dataframe is...
> results <- anneal(overall.model, par, var, quru.run, par_lo, par_hi, dnorm, "BAI", hessian = T, slimit=1.92, max_iter=100000)
> 
> save(results,file=file.path("Outputs", paste(run.label, "_Results.Rdata", sep="")))
> 
> write_results(results,file.path("Outputs", paste(run.label, "_Results.txt", sep="")))
> 
> ## display some of the results in the console
> results$best_pars;
$aa
[1] 1

$ab
[1] 0.01359362

$gmax
[1] 6971.036

$ca
[1] 17.96333

$cb
[1] 165.2035

$cc
[1] 5

$cd
[1] 0.006105745

$ce
[1] 0

$cf
[1] 1957.747

$cg
[1] -93.49302

$ta1
[1] 283.7287

$tb1
[1] 2.322271

$pa1
[1] 4999.896

$pb1
[1] 3144.791

$pc1
[1] 0.08346152

$sd
[1] 550.2751

> results$max_likeli;
[1] -1700.653
> results$aic_corr ;
[1] 3435.985
> results$slope;
[1] 1.002694
> results$R2
[1] 0.7437443
> 
> ####################################################################################################################
> ####################################################################################################################
> load(file=file.path("Outputs", paste(run.label, "_Results.Rdata", sep="")))
> 
> 
> # Looking at Residuals and Parameters
> #windows()
> plot(results$source_data$predicted,results$source_data$BAI,xlab="Predicted",ylab="Observed")
> abline(0,1,lwd=2,col="red")
> 
> results$source_data$residual <- results$source_data$BAI - results$source_data$predicted
> #windows()
> hist(results$source_data$residual)
> 
> 
> ##################################
> autogenic.effect <- function(SIZE,aa,ab) { (1 - aa*exp(-ab*SIZE))  }
> ##################################
> plot(BAI ~ BA.tree.cm2, data=results$source_data)
> plot(BAI ~ Age, data=results$source_data)
> plot(BA.tree.cm2 ~ Age, data=results$source_data)
> 
> summary(results$source_data$BA.tree.cm2)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  11.21   37.26  227.80  539.60  807.50 2830.00 
> summary(results$source_data$Age)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   15.0    48.0    75.5    77.8    93.0   178.0 
> 
> # Effect of Tree Basal Area
> #windows()
> par(mar=c(5,5,4,2), mfrow=c(1,1))
> x <- seq(0,max(ceiling(results$source_data$BA.tree.cm2)),1)
> y <- autogenic.effect(x,results$best_pars$aa,results$best_pars$ab)
> 
> pdf(file.path("Figures", paste(run.label, " - Autogenic Scalar.pdf", sep="")))
> plot(x,y,ylim=c(0,1),xlab="Tree Basal Area (cm2)",ylab="Effect of Size on Growth",
+      cex.axis=1.25,cex.lab=1.5,type="l",lwd=2,main=run.label)
> dev.off()
pdf 
  2 
> 
> 
> #################################
> size.effect <- function(SIZE,ca,cb,cc) {ca*exp(-cb*(SIZE^cc))}
> comp.effect <- function(BA.PLOT,ce,cf,cg) {ce/1000 + ( (1-ce/1000)/(1+(BA.PLOT/cf)^cg))}
> comp.response <- function(SIZE,BA.PLOT,ca,cb,cc,cd,ce,cf,cg)
+   { size.effect <- ca*exp(-cb*(SIZE^cc))
+     comp.effect <- (ce/1000 + ( (1-ce/1000)/(1+(BA.PLOT/cf)^cg)))
+     comp.response <- exp(-size.effect*(comp.effect^cd)) }
> ##################################
> # Size Effect
> plot(BAI ~ RelBA, data=results$source_data)
> 
> par(mar=c(5,5,4,2))
> x <- seq(0,1,0.01)
> y <- size.effect(x,results$best_pars$ca, results$best_pars$cb,results$best_pars$cc)
> summary(y)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
 0.0000  0.0000  0.1029  5.9690 15.2900 17.9600 
> 
> pdf(file.path("Figures", paste(run.label, " - Competition Size Effect.pdf", sep="")))
> plot(x,y,xlab="Relative Size",ylab="Size Effect",type="l",lwd=2,
+       cex.lab=1.5,cex.axis=1.25,main=run.label)
> #savePlot(file=paste("Competition Plot 1 ",run.label,".png",sep=""),type="png")
> dev.off()
pdf 
  2 
> 
> #####################
> # Plot BA effect
> plot(BAI ~ BA.m2ha.plot, data=results$source_data)
> 
> par(mar=c(5,5,4,2))
> x <- seq(0,60,0.1)
> y <- comp.effect(x, results$best_pars$ce, results$best_pars$cf,results$best_pars$cg)
> summary(y)
      Min.    1st Qu.     Median       Mean    3rd Qu.       Max. 
 0.000e+00  0.000e+00  0.000e+00 3.516e-144  0.000e+00 3.079e-142 
> 
> pdf(file.path("Figures", paste(run.label, " - Competition Competitive Effect.pdf", sep="")))
> plot(x,y,ylim=c(0,1),xlab="Plot BA",ylab="Competitive Effect",type="l",lwd=2,
+        cex.lab=1.5,cex.axis=1.25,main=run.label)
> dev.off()
pdf 
  2 
> #savePlot(file=paste("Competition Plot 2 ",run.label,".png",sep=""),type="png")
> 
> #####################
> # Competition Response: Size vs. Response with different plot BA levels
> plot(BA.m2ha.plot~ RelBA, data=results$source_data)
> 
> 
> pdf(file.path("Figures", paste(run.label, " - Competition Response Scalar.pdf", sep="")))
> par(mar=c(5,5,4,2))
> colors <- c("red","orange","blue","cyan","green")
> x <- seq(0,1,0.01)
> y <- comp.response(SIZE=x, BA.PLOT=50, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> plot(x,y,ylim=c(0,1),xlab="Relative Size",ylab="Competition Scalar",type="l",col=colors[1],lwd=2,
+      cex.lab=1.5,cex.axis=1.25,main=run.label)
> y <- comp.response(SIZE=x, BA.PLOT=40, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[2],lwd=2)
> y <- comp.response(SIZE=x, BA.PLOT=30, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[3],lwd=2)
> y <- comp.response(SIZE=x, BA.PLOT=20, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[4],lwd=2)
> y <- comp.response(SIZE=x, BA.PLOT=10, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[5],lwd=2)
> lines(x,y,col=colors[6],lwd=2)
> legend("bottomright",legend=c(50,40,30,20,10),col=colors,bty="n",lwd=2,title="Plot\nBasal\nArea",cex=1.25)
> dev.off()
pdf 
  2 
> #savePlot(file=paste("Competition Plot 3 ",run.label,".png",sep=""),type="png")
> 
> 
> ##################################
> temp.effect <- function(TEMP,ta1,tb1)
+        { (exp(-0.5*(((TEMP)-ta1)/tb1)^2))  }
> 
> precip.effect <- function(PRECIP,pa1,pb1)
+        { (exp(-0.5*(((PRECIP)-pa1)/pb1)^2)) }
> 
> # precip.effect <- function(PRECIP,pa1,pb1)
>        # { (1/(1+((PRECIP)/pa1)^pb1))  }
> 
> climate.effect <- function(TEMP,PRECIP,ta1,tb1,pa1,pb1)
+        { (exp(-0.5*(((TEMP)-ta1)/tb1)^2)) * (exp(-0.5*(((PRECIP)-pa1)/pb1)^2)) }
> ##################################
> # Temperature
> plot(quru.run$BAI ~ rowMeans(quru.run[,temp.col]), xlab="Mean Temp Mar-Oct", ylab="BAI (mm)")
Error in `[.data.frame`(quru.run, , temp.col) : 
  object 'temp.col' not found
Calls: plot ... eval -> rowMeans -> is.data.frame -> [ -> [.data.frame
Execution halted
