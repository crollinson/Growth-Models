
R version 2.15.3 (2013-03-01) -- "Security Blanket"
Copyright (C) 2013 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ####################################################
> # ACRU MODEL Autogenic x Competition x (Temp x Precip) :
> # Autogenic: Size/Age logistic scalar with Max potential growth for absolute values
> # Competition: Relative Size, Plot BA Scalars
> # Climate: Jan-Dec
> #	-- Temp: Mean Jan-Dec, Gaussian
> #	-- Precip: Sum Jan-Dec + upslope flow, Gaussian
> #
> ####################################################
> rm(list=ls())
> 
> data_directory <- "~/CARCA/Growth-Models/Annual/"
> #memory.size(4024)
> setwd(data_directory)
> library(likelihood)
Loading required package: nlme
> 
> # run.label <- "ACRU_Full_Ann"
> # load(file=paste( run.label, "_Results.Rdata", sep=""))
> 
> run.label <- "ACRU_Full_Ann"
> 
> #############
> # Reading in Test Data & some formating
> all.data <-read.csv("../Raw Inputs/CARCA_CoreData_Climate_Annual.csv")
> all.data[,substr(names(all.data),1,4)=="Tavg"] <- all.data[,substr(names(all.data),1,4)=="Tavg"]+273.15
> all.data$BA.tree.cm2 <- all.data$BA.tree/100
> all.data$Site.Trans <- as.factor(substr(all.data$PlotID,1,4))
> summary(all.data)
      Year          PlotID        Site       Trans           Plot      
 Min.   :1771   HNKC2  :  8505   BLD:62694   A: 88452   Min.   :1.000  
 1st Qu.:1831   FLTA1  :  7776   FLT:49329   B: 93798   1st Qu.:1.000  
 Median :1892   HIKA1  :  7290   HIK:48357   C:106434   Median :2.000  
 Mean   :1892   HNKB2  :  7290   HNK:43983              Mean   :2.265  
 3rd Qu.:1953   HNKA3  :  7047   IRN:52245              3rd Qu.:3.000  
 Max.   :2013   BLDA2  :  6804   MOR:32076              Max.   :4.000  
                (Other):243972                                         
     TreeID            BAI                 CoreID       Pith      
 BLDA101:   243   Min.   :    0.00   BLDA101HI:   243   N:211896  
 BLDA102:   243   1st Qu.:   84.36   BLDA102HI:   243   Y: 76788  
 BLDA103:   243   Median :  244.79   BLDA103HI:   243             
 BLDA104:   243   Mean   :  459.83   BLDA104HI:   243             
 BLDA105:   243   3rd Qu.:  589.69   BLDA105HI:   243             
 BLDA106:   243   Max.   :18648.71   BLDA106HI:   243             
 (Other):287226   NA's   :202009     (Other)  :287226             
    Pith.Yr          Inner          Outer      Bark       Use       
 Min.   :1756    Min.   :1762   Min.   :1990   N:  6318   N:  4617  
 1st Qu.:1917    1st Qu.:1923   1st Qu.:2012   Y:282366   Y:284067  
 Median :1933    Median :1938   Median :2012                        
 Mean   :1936    Mean   :1939   Mean   :2012                        
 3rd Qu.:1953    3rd Qu.:1955   3rd Qu.:2012                        
 Max.   :2008    Max.   :2009   Max.   :2013                        
 NA's   :60021                                                      
                        Notes         Pith.offset         Tree      
 poor corr w/ master       :   972   Min.   : 0.00   Min.   : 1.00  
 poor correlation w/ master:   972   1st Qu.: 1.00   1st Qu.:10.00  
 1977 missing              :   486   Median : 2.00   Median :18.50  
 1986 missing              :   486   Mean   : 3.35   Mean   :20.86  
 1999 missing              :   486   3rd Qu.: 5.00   3rd Qu.:30.00  
 (Other)                   : 14094   Max.   :20.00   Max.   :84.00  
 NA's                      :271188   NA's   :60021                  
      Spp              Genus         Canopy         Live       
 ACRU   :71199   Quercus  :111294   C   :148230   DEAD:   243  
 QUPR   :50787   Acer     : 85779   D   :  8748   LIVE:288441  
 QURU   :43740   Nyssa    : 38880   I   : 86022                
 NYSY   :38880   Magnolia : 11421   U   : 45441                
 ACSA   :14580   Betula   :  8262   NA's:   243                
 MAAC   : 9720   Sassafras:  7776                              
 (Other):59778   (Other)  : 25272                              
      Age            BA.m2ha          BAI.filled          BA.tree      
 Min.   :  0.00   Min.   : 0.0000   Min.   :    0.00   Min.   :     0  
 1st Qu.: 19.00   1st Qu.: 0.0000   1st Qu.:    0.00   1st Qu.:     0  
 Median : 40.00   Median : 0.0000   Median :    0.00   Median :     0  
 Mean   : 44.55   Mean   : 0.1771   Mean   :  149.04   Mean   :  6106  
 3rd Qu.: 64.00   3rd Qu.: 0.0615   3rd Qu.:   74.84   3rd Qu.:  2007  
 Max.   :256.00   Max.   :11.8597   Max.   :18648.71   Max.   :462177  
 NA's   :195231   NA's   :1047      NA's   :985        NA's   :1047    
     Stems          Density.Ha     BAI.filled.plot      BA.plot       
 Min.   :0.0000   Min.   : 0.000   Min.   :    0.0   Min.   :    0.0  
 1st Qu.:0.0000   1st Qu.: 0.000   1st Qu.:    0.0   1st Qu.:    0.0  
 Median :0.0000   Median : 0.000   Median :  904.8   Median :  581.2  
 Mean   :0.3191   Mean   : 9.728   Mean   : 3899.5   Mean   : 2063.0  
 3rd Qu.:1.0000   3rd Qu.:31.831   3rd Qu.: 6247.5   3rd Qu.: 2866.9  
 Max.   :1.0000   Max.   :49.736   Max.   :38677.4   Max.   :23212.2  
                                   NA's   :1500      NA's   :1500     
  BA.m2ha.plot     Density.ha.plot     Stems.plot     BAI.m2ha.plot   
 Min.   : 0.0000   Min.   :   0.00   Min.   : 0.000   Min.   :0.0000  
 1st Qu.: 0.0000   1st Qu.:   0.00   1st Qu.: 0.000   1st Qu.:0.0000  
 Median : 0.0705   Median :  63.66   Median : 2.000   Median :0.0274  
 Mean   : 3.4704   Mean   : 268.53   Mean   : 8.898   Mean   :0.1135  
 3rd Qu.: 4.3534   3rd Qu.: 509.30   3rd Qu.:18.000   3rd Qu.:0.1935  
 Max.   :35.8804   Max.   :1432.39   Max.   :45.000   Max.   :1.0485  
 NA's   :1500      NA's   :1500      NA's   :1500     NA's   :1500    
 BA.m2ha.plot.live     RelBA          Site.Trans        Latitude     
 Min.   : 0.000    Min.   :0.00     BLDC   : 23814   Min.   :36.75   
 1st Qu.: 0.000    1st Qu.:0.05     IRNC   : 20898   1st Qu.:37.24   
 Median : 1.116    Median :0.17     HIKC   : 20169   Median :37.91   
 Mean   : 5.122    Mean   :0.30     BLDA   : 19926   Mean   :37.74   
 3rd Qu.: 6.584    3rd Qu.:0.46     BLDB   : 18954   3rd Qu.:38.32   
 Max.   :57.620    Max.   :1.00     IRNB   : 18711   Max.   :38.58   
 NA's   :985       NA's   :199115   (Other):166212   NA's   :153252  
   Longitude           elev             flow             TPI        
 Min.   :-81.31   Min.   : 666.9   Min.   :0.01     Min.   :-0.23   
 1st Qu.:-80.86   1st Qu.: 843.7   1st Qu.:0.01     1st Qu.:-0.10   
 Median :-79.85   Median : 952.4   Median :0.03     Median :-0.03   
 Mean   :-80.10   Mean   : 955.7   Mean   :0.12     Mean   : 0.01   
 3rd Qu.:-79.22   3rd Qu.:1098.3   3rd Qu.:0.06     3rd Qu.: 0.15   
 Max.   :-79.15   Max.   :1256.7   Max.   :1.42     Max.   : 0.30   
 NA's   :153252   NA's   :153252   NA's   :153252   NA's   :153252  
      sol            sol.lag          Anomaly            Tavg       
 Min.   : 90338   Min.   : 90338   Min.   :-1.48    Min.   :277.5   
 1st Qu.: 99340   1st Qu.: 99340   1st Qu.:-0.40    1st Qu.:281.6   
 Median :107050   Median :107050   Median : 0.01    Median :282.8   
 Mean   :110569   Mean   :110569   Mean   : 0.00    Mean   :282.5   
 3rd Qu.:121199   3rd Qu.:121199   3rd Qu.: 0.37    3rd Qu.:283.6   
 Max.   :133748   Max.   :133748   Max.   : 1.31    Max.   :285.8   
 NA's   :153252   NA's   :153252   NA's   :153252   NA's   :153252  
  Precip.PRISM      Tavg.PRISM     Precip.PRISM.sum  BA.tree.cm2     
 Min.   : 41.00   Min.   :281.3    Min.   : 492.0   Min.   :   0.00  
 1st Qu.: 81.45   1st Qu.:282.6    1st Qu.: 977.4   1st Qu.:   0.00  
 Median : 92.11   Median :283.2    Median :1105.4   Median :   0.00  
 Mean   : 93.52   Mean   :283.2    Mean   :1122.2   Mean   :  61.06  
 3rd Qu.:103.05   3rd Qu.:283.8    3rd Qu.:1236.7   3rd Qu.:  20.07  
 Max.   :152.72   Max.   :285.6    Max.   :1832.7   Max.   :4621.77  
 NA's   :154440   NA's   :261360   NA's   :154440   NA's   :1047     
> dim(all.data)
[1] 288684     49
> 
> #############
> # Subsetting just ACRU data
> acru.all <- all.data[all.data$Spp=="ACRU", ]
> summary(acru.all)
      Year          PlotID       Site       Trans          Plot      
 Min.   :1771   BLDB2  : 4374   BLD:15066   A:14094   Min.   :1.000  
 1st Qu.:1831   BLDB1  : 3645   FLT: 5346   B:33048   1st Qu.:1.000  
 Median :1892   HIKB4  : 3159   HIK:18468   C:24057   Median :2.000  
 Mean   :1892   HNKB1  : 3159   HNK: 8505             Mean   :2.191  
 3rd Qu.:1953   MORC1  : 3159   IRN:12150             3rd Qu.:3.000  
 Max.   :2013   HIKB3  : 2916   MOR:11664             Max.   :4.000  
                (Other):50787                                        
     TreeID           BAI               CoreID      Pith         Pith.Yr     
 BLDA418:  243   Min.   :   0.0   BLDA418HI:  243   N:48600   Min.   :1898   
 BLDA423:  243   1st Qu.:  50.1   BLDA423HI:  243   Y:22599   1st Qu.:1918   
 BLDB101:  243   Median : 123.2   BLDB101HI:  243             Median :1937   
 BLDB105:  243   Mean   : 255.7   BLDB105HI:  243             Mean   :1939   
 BLDB106:  243   3rd Qu.: 292.8   BLDB106HI:  243             3rd Qu.:1957   
 BLDB109:  243   Max.   :8051.9   BLDB109HI:  243             Max.   :1995   
 (Other):69741   NA's   :50724    (Other)  :69741             NA's   :13122  
     Inner          Outer      Bark      Use                       Notes      
 Min.   :1899   Min.   :1990   N: 1944   N:  729   poor corr w/ master:  729  
 1st Qu.:1923   1st Qu.:2012   Y:69255   Y:70470   1977 missing       :  486  
 Median :1940   Median :2012                       2011, 2003 missing :  486  
 Mean   :1943   Mean   :2012                       B side dated       :  486  
 3rd Qu.:1959   3rd Qu.:2012                       1931 missing       :  243  
 Max.   :1996   Max.   :2013                       (Other)            : 3159  
                                                   NA's               :65610  
  Pith.offset          Tree            Spp             Genus       Canopy   
 Min.   : 1.000   Min.   : 1.00   ACRU   :71199   Acer    :71199   C:29646  
 1st Qu.: 1.000   1st Qu.:10.00   ACSA   :    0   Betula  :    0   D:    0  
 Median : 2.000   Median :20.00   BELE   :    0   Carya   :    0   I:30375  
 Mean   : 2.632   Mean   :21.34   BEPA   :    0   Castanea:    0   U:11178  
 3rd Qu.: 3.000   3rd Qu.:29.00   CADE   :    0   Cornus  :    0            
 Max.   :10.000   Max.   :84.00   CAGL   :    0   Juglans :    0            
 NA's   :13122                    (Other):    0   (Other) :    0            
   Live            Age            BA.m2ha          BAI.filled     
 DEAD:    0   Min.   :  0.00   Min.   :0.00000   Min.   :   0.00  
 LIVE:71199   1st Qu.: 18.00   1st Qu.:0.00000   1st Qu.:   0.00  
              Median : 37.00   Median :0.00000   Median :   0.00  
              Mean   : 39.81   Mean   :0.07019   Mean   :  77.42  
              3rd Qu.: 59.00   3rd Qu.:0.02599   3rd Qu.:  35.37  
              Max.   :122.00   Max.   :4.30178   Max.   :8051.91  
              NA's   :49432    NA's   :276       NA's   :271      
    BA.tree             Stems          Density.Ha     BAI.filled.plot   
 Min.   :     0.0   Min.   :0.0000   Min.   : 0.000   Min.   :    0.00  
 1st Qu.:     0.0   1st Qu.:0.0000   1st Qu.: 0.000   1st Qu.:    0.43  
 Median :     0.0   Median :0.0000   Median : 0.000   Median : 1201.23  
 Mean   :  2451.3   Mean   :0.2996   Mean   : 8.931   Mean   : 4011.40  
 3rd Qu.:   872.6   3rd Qu.:1.0000   3rd Qu.:22.105   3rd Qu.: 6146.53  
 Max.   :135148.7   Max.   :1.0000   Max.   :49.736   Max.   :38677.40  
 NA's   :276                                          NA's   :660       
    BA.plot         BA.m2ha.plot     Density.ha.plot     Stems.plot    
 Min.   :    0.0   Min.   : 0.0000   Min.   :   0.00   Min.   : 0.000  
 1st Qu.:    0.0   1st Qu.: 0.0000   1st Qu.:  14.15   1st Qu.: 1.000  
 Median :  891.2   Median : 0.3599   Median :  88.42   Median : 3.000  
 Mean   : 2265.8   Mean   : 3.5121   Mean   : 273.71   Mean   : 9.231  
 3rd Qu.: 3156.2   3rd Qu.: 4.5001   3rd Qu.: 481.00   3rd Qu.:18.000  
 Max.   :23212.2   Max.   :35.7168   Max.   :1432.39   Max.   :45.000  
 NA's   :660       NA's   :660       NA's   :660       NA's   :660     
 BAI.m2ha.plot    BA.m2ha.plot.live     RelBA         Site.Trans   
 Min.   :0.0000   Min.   : 0.000    Min.   :0.00    BLDB   :10449  
 1st Qu.:0.0000   1st Qu.: 0.000    1st Qu.:0.02    HIKB   : 7533  
 Median :0.0366   Median : 1.321    Median :0.06    HIKC   : 7047  
 Mean   :0.1148   Mean   : 5.403    Mean   :0.13    MORC   : 5832  
 3rd Qu.:0.1870   3rd Qu.: 7.263    3rd Qu.:0.16    IRNC   : 5589  
 Max.   :1.0485   Max.   :57.620    Max.   :1.00    IRNB   : 5103  
 NA's   :660      NA's   :271       NA's   :50889   (Other):29646  
    Latitude       Longitude           elev             flow      
 Min.   :36.75   Min.   :-81.31   Min.   : 666.9   Min.   :0.01   
 1st Qu.:37.72   1st Qu.:-80.11   1st Qu.: 834.4   1st Qu.:0.01   
 Median :37.92   Median :-79.84   Median : 941.8   Median :0.03   
 Mean   :37.85   Mean   :-79.96   Mean   : 933.0   Mean   :0.10   
 3rd Qu.:38.57   3rd Qu.:-79.17   3rd Qu.:1022.4   3rd Qu.:0.08   
 Max.   :38.58   Max.   :-79.15   Max.   :1251.0   Max.   :1.42   
 NA's   :37797   NA's   :37797    NA's   :37797    NA's   :37797  
      TPI             sol            sol.lag          Anomaly     
 Min.   :-0.23   Min.   : 90338   Min.   : 90338   Min.   :-1.48  
 1st Qu.:-0.11   1st Qu.: 98245   1st Qu.: 98245   1st Qu.:-0.40  
 Median :-0.05   Median :103950   Median :103950   Median : 0.01  
 Mean   : 0.00   Mean   :107157   Mean   :107157   Mean   : 0.00  
 3rd Qu.: 0.17   3rd Qu.:119273   3rd Qu.:119273   3rd Qu.: 0.37  
 Max.   : 0.30   Max.   :133748   Max.   :133748   Max.   : 1.31  
 NA's   :37797   NA's   :37797    NA's   :37797    NA's   :37797  
      Tavg        Precip.PRISM      Tavg.PRISM    Precip.PRISM.sum
 Min.   :277.5   Min.   : 41.00   Min.   :281.3   Min.   : 492.0  
 1st Qu.:281.6   1st Qu.: 81.28   1st Qu.:282.4   1st Qu.: 975.3  
 Median :282.8   Median : 91.20   Median :283.1   Median :1094.4  
 Mean   :282.4   Mean   : 92.99   Mean   :283.1   Mean   :1115.8  
 3rd Qu.:283.6   3rd Qu.:102.41   3rd Qu.:283.7   3rd Qu.:1228.9  
 Max.   :285.4   Max.   :152.72   Max.   :285.0   Max.   :1832.7  
 NA's   :37797   NA's   :38090    NA's   :64460   NA's   :38090   
  BA.tree.cm2      
 Min.   :   0.000  
 1st Qu.:   0.000  
 Median :   0.000  
 Mean   :  24.513  
 3rd Qu.:   8.726  
 Max.   :1351.487  
 NA's   :276       
> dim(acru.all)
[1] 71199    49
> 
> # Subsetting only complete cases & a small range of years
> acru.run <- acru.all[complete.cases(acru.all) & acru.all$Year>=1990 & acru.all$Year<=2011,]
> summary(acru.run)
      Year          PlotID    Site     Trans        Plot           TreeID   
 Min.   :1990   HIKC4  :88   BLD:  0   A: 44   Min.   :1.000   HIKA220: 22  
 1st Qu.:1995   HIKB4  :64   FLT:  0   B:174   1st Qu.:2.000   HIKB321: 22  
 Median :2000   HIKB3  :44   HIK:240   C:154   Median :3.000   HIKB333: 22  
 Mean   :2000   MORB2  :44   HNK: 66           Mean   :2.995   HIKB409: 22  
 3rd Qu.:2006   HIKA2  :22   IRN:  0           3rd Qu.:4.000   HIKB413: 22  
 Max.   :2011   HIKC3  :22   MOR: 66           Max.   :4.000   HIKC313: 22  
                (Other):88                                     (Other):240  
      BAI                CoreID    Pith       Pith.Yr         Inner     
 Min.   :   3.79   HIKA220HI: 22   N:240   Min.   :1910   Min.   :1911  
 1st Qu.:  33.36   HIKB321HI: 22   Y:132   1st Qu.:1928   1st Qu.:1931  
 Median :  66.93   HIKB333HI: 22           Median :1945   Median :1946  
 Mean   : 168.88   HIKB409HI: 22           Mean   :1947   Mean   :1950  
 3rd Qu.: 226.54   HIKB413HI: 22           3rd Qu.:1971   3rd Qu.:1973  
 Max.   :1227.60   HIKC313HI: 22           Max.   :1976   Max.   :1977  
                   (Other)  :240                                        
     Outer      Bark    Use                     Notes      Pith.offset   
 Min.   :2008   N: 66   N: 64   poor corr w/ master: 64   Min.   :1.000  
 1st Qu.:2012   Y:306   Y:308   2011, 2003 missing : 44   1st Qu.:1.000  
 Median :2012                   B side dated       : 44   Median :2.000  
 Mean   :2012                   1931 missing       : 22   Mean   :2.704  
 3rd Qu.:2012                   1977 missing       : 22   3rd Qu.:3.000  
 Max.   :2012                   1986 missing       : 22   Max.   :6.000  
                                (Other)            :154                  
      Tree           Spp           Genus     Canopy    Live    
 Min.   : 3.0   ACRU   :372   Acer    :372   C: 66   DEAD:  0  
 1st Qu.:12.0   ACSA   :  0   Betula  :  0   D:  0   LIVE:372  
 Median :17.0   BELE   :  0   Carya   :  0   I:176             
 Mean   :18.7   BEPA   :  0   Castanea:  0   U:130             
 3rd Qu.:21.0   CADE   :  0   Cornus  :  0                     
 Max.   :43.0   CAGL   :  0   Juglans :  0                     
                (Other):  0   (Other) :  0                     
      Age            BA.m2ha          BAI.filled         BA.tree        
 Min.   : 14.00   Min.   :0.02517   Min.   :   3.79   Min.   :   790.8  
 1st Qu.: 31.00   1st Qu.:0.08389   1st Qu.:  33.36   1st Qu.:  2558.2  
 Median : 54.50   Median :0.10382   Median :  66.93   Median :  3328.3  
 Mean   : 53.47   Mean   :0.27640   Mean   : 168.88   Mean   : 11389.6  
 3rd Qu.: 75.00   3rd Qu.:0.29454   3rd Qu.: 226.54   3rd Qu.: 10258.9  
 Max.   :101.00   Max.   :2.01256   Max.   :1227.60   Max.   :106880.5  
                                                                        
     Stems     Density.Ha    BAI.filled.plot    BA.plot       BA.m2ha.plot   
 Min.   :1   Min.   :18.83   Min.   : 4746   Min.   : 3848   Min.   : 7.291  
 1st Qu.:1   1st Qu.:31.83   1st Qu.:11309   1st Qu.: 7434   1st Qu.:10.596  
 Median :1   Median :31.83   Median :14623   Median : 9491   Median :14.734  
 Mean   :1   Mean   :30.97   Mean   :16014   Mean   : 9760   Mean   :14.942  
 3rd Qu.:1   3rd Qu.:31.83   3rd Qu.:20816   3rd Qu.:11945   3rd Qu.:18.980  
 Max.   :1   Max.   :49.74   Max.   :35507   Max.   :17348   Max.   :27.329  
                                                                             
 Density.ha.plot    Stems.plot    BAI.m2ha.plot    BA.m2ha.plot.live
 Min.   : 442.1   Min.   :20.00   Min.   :0.2237   Min.   : 9.423   
 1st Qu.: 732.1   1st Qu.:23.00   1st Qu.:0.3259   1st Qu.:17.057   
 Median : 891.3   Median :28.00   Median :0.4500   Median :20.615   
 Mean   : 923.2   Mean   :29.83   Mean   :0.4737   Mean   :20.891   
 3rd Qu.:1094.2   3rd Qu.:34.00   3rd Qu.:0.6097   3rd Qu.:24.852   
 Max.   :1305.1   Max.   :41.00   Max.   :1.0485   Max.   :36.352   
                                                                    
     RelBA            Site.Trans     Latitude       Longitude     
 Min.   :0.007068   HIKC   :110   Min.   :37.72   Min.   :-80.11  
 1st Qu.:0.019302   HIKB   :108   1st Qu.:38.32   1st Qu.:-79.22  
 Median :0.031049   MORB   : 44   Median :38.57   Median :-79.16  
 Mean   :0.122781   HIKA   : 22   Mean   :38.38   Mean   :-79.34  
 3rd Qu.:0.245713   HNKA   : 22   3rd Qu.:38.57   3rd Qu.:-79.15  
 Max.   :0.499999   HNKB   : 22   Max.   :38.57   Max.   :-79.15  
                    (Other): 44                                   
      elev             flow               TPI                sol        
 Min.   : 666.9   Min.   :0.006178   Min.   :-0.21457   Min.   : 90798  
 1st Qu.: 812.2   1st Qu.:0.014916   1st Qu.:-0.11032   1st Qu.: 99349  
 Median : 823.7   Median :0.094803   Median :-0.10876   Median : 99482  
 Mean   : 847.6   Mean   :0.157775   Mean   : 0.03387   Mean   :100864  
 3rd Qu.: 926.1   3rd Qu.:0.097767   3rd Qu.: 0.23851   3rd Qu.:104810  
 Max.   :1097.5   Max.   :1.240813   Max.   : 0.28718   Max.   :110110  
                                                                        
    sol.lag          Anomaly              Tavg        Precip.PRISM   
 Min.   : 90798   Min.   :-0.78176   Min.   :280.2   Min.   : 65.15  
 1st Qu.: 99349   1st Qu.:-0.32481   1st Qu.:282.1   1st Qu.: 79.28  
 Median : 99482   Median : 0.04472   Median :282.8   Median : 84.84  
 Mean   :100864   Mean   : 0.10272   Mean   :282.8   Mean   : 88.13  
 3rd Qu.:104810   3rd Qu.: 0.48712   3rd Qu.:283.6   3rd Qu.: 91.11  
 Max.   :110110   Max.   : 1.12121   Max.   :285.2   Max.   :142.71  
                                                                     
   Tavg.PRISM    Precip.PRISM.sum  BA.tree.cm2      
 Min.   :281.3   Min.   : 781.8   Min.   :   7.908  
 1st Qu.:282.2   1st Qu.: 951.3   1st Qu.:  25.582  
 Median :282.7   Median :1018.0   Median :  33.283  
 Mean   :282.8   Mean   :1057.5   Mean   : 113.896  
 3rd Qu.:283.5   3rd Qu.:1093.3   3rd Qu.: 102.589  
 Max.   :285.0   Max.   :1712.6   Max.   :1068.805  
                                                    
> dim(acru.run)
[1] 372  49
> 
> write.csv(acru.run, "Inputs/ACRU_AllSites_1990-2011.csv", row.names=F)
> 
> ################################################
> # Reading in Data
> acru.run <- read.csv("Inputs/ACRU_AllSites_1990-2011.csv")
> summary(acru.run)
      Year          PlotID    Site     Trans        Plot           TreeID   
 Min.   :1990   HIKC4  :88   HIK:240   A: 44   Min.   :1.000   HIKA220: 22  
 1st Qu.:1995   HIKB4  :64   HNK: 66   B:174   1st Qu.:2.000   HIKB321: 22  
 Median :2000   HIKB3  :44   MOR: 66   C:154   Median :3.000   HIKB333: 22  
 Mean   :2000   MORB2  :44                     Mean   :2.995   HIKB409: 22  
 3rd Qu.:2006   HIKA2  :22                     3rd Qu.:4.000   HIKB413: 22  
 Max.   :2011   HIKC3  :22                     Max.   :4.000   HIKC313: 22  
                (Other):88                                     (Other):240  
      BAI                CoreID    Pith       Pith.Yr         Inner     
 Min.   :   3.79   HIKA220HI: 22   N:240   Min.   :1910   Min.   :1911  
 1st Qu.:  33.36   HIKB321HI: 22   Y:132   1st Qu.:1928   1st Qu.:1931  
 Median :  66.93   HIKB333HI: 22           Median :1945   Median :1946  
 Mean   : 168.88   HIKB409HI: 22           Mean   :1947   Mean   :1950  
 3rd Qu.: 226.54   HIKB413HI: 22           3rd Qu.:1971   3rd Qu.:1973  
 Max.   :1227.60   HIKC313HI: 22           Max.   :1976   Max.   :1977  
                   (Other)  :240                                        
     Outer      Bark    Use                     Notes      Pith.offset   
 Min.   :2008   N: 66   N: 64   poor corr w/ master: 64   Min.   :1.000  
 1st Qu.:2012   Y:306   Y:308   2011, 2003 missing : 44   1st Qu.:1.000  
 Median :2012                   B side dated       : 44   Median :2.000  
 Mean   :2012                   1931 missing       : 22   Mean   :2.704  
 3rd Qu.:2012                   1977 missing       : 22   3rd Qu.:3.000  
 Max.   :2012                   1986 missing       : 22   Max.   :6.000  
                                (Other)            :154                  
      Tree        Spp       Genus     Canopy    Live          Age        
 Min.   : 3.0   ACRU:372   Acer:372   C: 66   LIVE:372   Min.   : 14.00  
 1st Qu.:12.0                         I:176              1st Qu.: 31.00  
 Median :17.0                         U:130              Median : 54.50  
 Mean   :18.7                                            Mean   : 53.47  
 3rd Qu.:21.0                                            3rd Qu.: 75.00  
 Max.   :43.0                                            Max.   :101.00  
                                                                         
    BA.m2ha          BAI.filled         BA.tree             Stems  
 Min.   :0.02517   Min.   :   3.79   Min.   :   790.8   Min.   :1  
 1st Qu.:0.08389   1st Qu.:  33.36   1st Qu.:  2558.2   1st Qu.:1  
 Median :0.10382   Median :  66.93   Median :  3328.3   Median :1  
 Mean   :0.27640   Mean   : 168.88   Mean   : 11389.6   Mean   :1  
 3rd Qu.:0.29454   3rd Qu.: 226.54   3rd Qu.: 10258.9   3rd Qu.:1  
 Max.   :2.01256   Max.   :1227.60   Max.   :106880.5   Max.   :1  
                                                                   
   Density.Ha    BAI.filled.plot    BA.plot       BA.m2ha.plot   
 Min.   :18.83   Min.   : 4746   Min.   : 3848   Min.   : 7.291  
 1st Qu.:31.83   1st Qu.:11309   1st Qu.: 7434   1st Qu.:10.596  
 Median :31.83   Median :14623   Median : 9491   Median :14.734  
 Mean   :30.97   Mean   :16014   Mean   : 9760   Mean   :14.942  
 3rd Qu.:31.83   3rd Qu.:20816   3rd Qu.:11945   3rd Qu.:18.980  
 Max.   :49.74   Max.   :35507   Max.   :17348   Max.   :27.329  
                                                                 
 Density.ha.plot    Stems.plot    BAI.m2ha.plot    BA.m2ha.plot.live
 Min.   : 442.1   Min.   :20.00   Min.   :0.2237   Min.   : 9.423   
 1st Qu.: 732.1   1st Qu.:23.00   1st Qu.:0.3259   1st Qu.:17.057   
 Median : 891.3   Median :28.00   Median :0.4500   Median :20.615   
 Mean   : 923.2   Mean   :29.83   Mean   :0.4737   Mean   :20.891   
 3rd Qu.:1094.2   3rd Qu.:34.00   3rd Qu.:0.6097   3rd Qu.:24.852   
 Max.   :1305.1   Max.   :41.00   Max.   :1.0485   Max.   :36.352   
                                                                    
     RelBA            Site.Trans     Latitude       Longitude     
 Min.   :0.007068   HIKC   :110   Min.   :37.72   Min.   :-80.11  
 1st Qu.:0.019302   HIKB   :108   1st Qu.:38.32   1st Qu.:-79.22  
 Median :0.031049   MORB   : 44   Median :38.57   Median :-79.16  
 Mean   :0.122781   HIKA   : 22   Mean   :38.38   Mean   :-79.34  
 3rd Qu.:0.245713   HNKA   : 22   3rd Qu.:38.57   3rd Qu.:-79.15  
 Max.   :0.499999   HNKB   : 22   Max.   :38.57   Max.   :-79.15  
                    (Other): 44                                   
      elev             flow               TPI                sol        
 Min.   : 666.9   Min.   :0.006178   Min.   :-0.21457   Min.   : 90798  
 1st Qu.: 812.2   1st Qu.:0.014916   1st Qu.:-0.11032   1st Qu.: 99349  
 Median : 823.7   Median :0.094803   Median :-0.10876   Median : 99482  
 Mean   : 847.6   Mean   :0.157775   Mean   : 0.03387   Mean   :100864  
 3rd Qu.: 926.1   3rd Qu.:0.097767   3rd Qu.: 0.23851   3rd Qu.:104810  
 Max.   :1097.5   Max.   :1.240813   Max.   : 0.28718   Max.   :110110  
                                                                        
    sol.lag          Anomaly              Tavg        Precip.PRISM   
 Min.   : 90798   Min.   :-0.78176   Min.   :280.2   Min.   : 65.15  
 1st Qu.: 99349   1st Qu.:-0.32481   1st Qu.:282.1   1st Qu.: 79.28  
 Median : 99482   Median : 0.04472   Median :282.8   Median : 84.84  
 Mean   :100864   Mean   : 0.10272   Mean   :282.8   Mean   : 88.13  
 3rd Qu.:104810   3rd Qu.: 0.48712   3rd Qu.:283.6   3rd Qu.: 91.11  
 Max.   :110110   Max.   : 1.12121   Max.   :285.2   Max.   :142.71  
                                                                     
   Tavg.PRISM    Precip.PRISM.sum  BA.tree.cm2      
 Min.   :281.3   Min.   : 781.8   Min.   :   7.908  
 1st Qu.:282.2   1st Qu.: 951.3   1st Qu.:  25.582  
 Median :282.7   Median :1018.0   Median :  33.283  
 Mean   :282.8   Mean   :1057.5   Mean   : 113.896  
 3rd Qu.:283.5   3rd Qu.:1093.3   3rd Qu.: 102.589  
 Max.   :285.0   Max.   :1712.6   Max.   :1068.805  
                                                    
> 
> # Loading previous runs
> #load(file="Test results for ACRU 4 - All Sites 1990-2011.Rdata")
> 
> ####################################################################################################################
> overall.model <- function(
+ 							SIZE,aa,ab, gmax,             # Autogenic (a) -- ABSOLUTE UNITS (from gmax)
+                             BA.PLOT,RS,ca,cb,cc,cd,ce,cf,cg, # Competition (c) -- scalar
+                             # # BA.PLOT,RS,ca,cb,cc,cd,cf,cg, # Competition (c) -- scalar, removed intercept
+                             TEMP,ta1,tb1,					 # Temperature (t) -- scalar
+                             PRECIP,FLOW,pa1,pb1,pc1         	 # Preciptiation (p) -- scalar
+                             # TRANS, ha		             	 # Habitat (h) -- scalar
+                             )
+ 	{
+ 	################
+ 	# Autogenic Growth: 0-1 * gmax (max possible growth, absolute units)
+ 	################
+ 	autogenic.effect <- gmax*(1 - aa*exp(-ab*SIZE))   
+ 	# autogenic.effect <- gmax*(1-aa*exp(-ab*SIZE))   
+ 
+ 
+ 	################
+ 	# Competition Effect: 0-1 
+ 	################
+ 	size.effect <- ca*exp(-cb*(RS^cc))
+ 	comp.effect <- (ce/1000 + ( (1-ce/1000)/(1+(BA.PLOT/cf)^cg)))
+ 	# comp.effect <- (1/(1+(BA.PLOT/cf)^cg))
+ 	comp.response <- exp(-size.effect*(comp.effect^cd))
+ 
+  	################
+ 	# Climate Effect: Now Scalar
+ 	################
+ 	
+ 	#Temp on scale 0-1
+     temp.effect <- (exp(-0.5*(((TEMP)-ta1)/tb1)^2))
+ 
+     # Precip on scale 0-1
+     # precip.effect <- t(1/(1+(t(PRECIP)/pa1)^pb1))
+ 	precip.effect <- (exp(-0.5*(((PRECIP + pc1*FLOW*PRECIP)-pa1)/pb1)^2)) # Gaussian Data Frame
+ 
+ 	# Multiplying temp & precip together
+     climate.effect <- temp.effect * precip.effect
+ 	 
+ 	 ### LEM: do row sums
+ 	 ##### CRR note: I think this should be on a scale from 0-1; 
+      # climate.effect <- colSums(climate.effect) 
+ 	 # climate.effect2 <- apply(climate.effect, 1, FUN=prod)
+ 	
+ 
+ 	################
+ 	# Habitat Effect: 0-1
+ 	# Note: removed from model for the moment, may add Topographic position or upslope area later
+ 	################
+ 	# habitat.effect <- ha[TRANS]
+ 
+ 	# comp.response <- 1
+ 	habitat.effect <- 1
+ 	# climate.effect2 <- precip.effect
+ 
+ 	autogenic.effect*comp.response*habitat.effect*climate.effect
+ 	
+ 
+ 	}
> 
> 
> ####################################################################################################################
> ####################################################################################################################
> ### setting up annealing
> 
> # par <- results$best_par
> 
> # need a list that gives initial values for all of the "parameters"
> par<-list(
+ 		  aa=1, ab=0.004, gmax=10000,  	# Autogenic
+           ca=1800, cb=6.6, cc=0.00, cd=0.01, ce=0, cf=26, cg=-39,  # Competition
+           ta1=263.8, tb1=32.8,
+           pa1=100, pb1=1700, pc1=0.85,
+           # # ha=rep(0.5,3),  # Habitat
+           sd=132)
> 
> # also need a list that identifies the independent variables
> var <- list(SIZE = "BA.tree.cm2",  # Autogenic
+             BA.PLOT="BA.m2ha.plot.live", RS="RelBA",  # Competition
+             TEMP = "Tavg", # hard-coded above
+             PRECIP = "Precip.PRISM.sum", FLOW="flow"
+             # TRANS="Site.Trans" # Habitat
+             )
> 
> ## Set bounds and initial search ranges within which to search for parameters
> ##   NOTE:  the s and sd parameters have to be greater than zero (algebraically)
> par_lo <-list(
+ 			  aa=0, ab=0, gmax=0,  # Autogenic
+               ca=0, cb=0, cc=0, cd=0, ce=0, cf=-100, cg=-1000, # Competition
+               # # ca=0, cb=0, cc=0, cd=0, cf=-100, cg=-200, # Competition
+               ta1=250, tb1=0,
+               pa1=100, pb1=0, pc1=0,
+ 			# ha=rep(0,3), # Habitat
+               sd=0.1)
> 
> 
> par_hi <-list(
+ 			  aa=1, ab=1000, gmax=10000, # Autogenic
+               ca=2000, cb=1000, cc=5, cd=5, ce=1000, cf=2000, cg=1000,	# Competition
+               # # ca=1000, cb=1000, cc=50, cd=5, cf=500, cg=1000,	# Competition
+               ta1=325, tb1=500,
+               pa1=5000, pb1=10000, pc1=1,
+               # ha=rep(1,3), # Habitat
+               sd=1000)
> 
> ## Specify the dependent variable, and name it using whatever
> ##    argument name is used in the pdf ("x" in the normal.pdf function above)
> var$x<-"BAI"
> 
> ## predicted value in your PDF should be given the reserved name "predicted"
> ##   Anneal will use your scientific model and your data and calculate the
> ##   predicted value for each observation and store it internally in an object
> ##   called "predicted"
> var$mean<-"predicted"
> 
> ## Have it calculate log likelihood
> var$log<-TRUE
> 
> ##  now call the annealing algorithm, choosing which model to use
> #  "data" should be whatever the name of your dataframe is...
> results <- anneal(overall.model, par, var, acru.run, par_lo, par_hi, dnorm, "BAI", hessian = T, slimit=1.92, max_iter=100000)
> 
> save(results,file=file.path("Outputs", paste(run.label, "_Results.Rdata", sep="")))
> 
> write_results(results,file.path("Outputs", paste(run.label, "_Results.txt", sep="")))
> 
> ## display some of the results in the console
> results$best_pars;
$aa
[1] 0.9999978

$ab
[1] 0.003656645

$gmax
[1] 1797.031

$ca
[1] 296.5395

$cb
[1] 5.113352

$cc
[1] 2.513153e-55

$cd
[1] 0.002287282

$ce
[1] 0

$cf
[1] 30.16836

$cg
[1] -877.1199

$ta1
[1] 271.2026

$tb1
[1] 128.2746

$pa1
[1] 545.8573

$pb1
[1] 1850.481

$pc1
[1] 0.946567

$sd
[1] 131.6361

> results$max_likeli;
[1] -2345.524
> results$aic_corr ;
[1] 4724.58
> results$slope;
[1] 0.9783051
> results$R2
[1] 0.63823
> 
> ####################################################################################################################
> ####################################################################################################################
> load(file=file.path("Outputs", paste(run.label, "_Results.Rdata", sep="")))
> 
> 
> # Looking at Residuals and Parameters
> #windows()
> plot(results$source_data$predicted,results$source_data$BAI,xlab="Predicted",ylab="Observed")
> abline(0,1,lwd=2,col="red")
> 
> results$source_data$residual <- results$source_data$BAI - results$source_data$predicted
> #windows()
> hist(results$source_data$residual)
> 
> 
> ##################################
> autogenic.effect <- function(SIZE,aa,ab) { (1 - aa*exp(-ab*SIZE))  }
> ##################################
> plot(BAI ~ BA.tree.cm2, data=results$source_data)
> plot(BAI ~ Age, data=results$source_data)
> plot(BA.tree.cm2 ~ Age, data=results$source_data)
> 
> summary(results$source_data$BA.tree.cm2)
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
   7.908   25.580   33.280  113.900  102.600 1069.000 
> summary(results$source_data$Age)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  14.00   31.00   54.50   53.47   75.00  101.00 
> 
> # Effect of Tree Basal Area
> #windows()
> par(mar=c(5,5,4,2), mfrow=c(1,1))
> x <- seq(0,max(ceiling(results$source_data$BA.tree.cm2)),1)
> y <- autogenic.effect(x,results$best_pars$aa,results$best_pars$ab)
> 
> pdf(file.path("Figures", paste(run.label, " - Autogenic Scalar.pdf", sep="")))
> plot(x,y,ylim=c(0,1),xlab="Tree Basal Area (cm2)",ylab="Effect of Size on Growth",
+      cex.axis=1.25,cex.lab=1.5,type="l",lwd=2,main=run.label)
> dev.off()
pdf 
  2 
> 
> 
> #################################
> size.effect <- function(SIZE,ca,cb,cc) {ca*exp(-cb*(SIZE^cc))}
> comp.effect <- function(BA.PLOT,ce,cf,cg) {ce/1000 + ( (1-ce/1000)/(1+(BA.PLOT/cf)^cg))}
> comp.response <- function(SIZE,BA.PLOT,ca,cb,cc,cd,ce,cf,cg)
+   { size.effect <- ca*exp(-cb*(SIZE^cc))
+     comp.effect <- (ce/1000 + ( (1-ce/1000)/(1+(BA.PLOT/cf)^cg)))
+     comp.response <- exp(-size.effect*(comp.effect^cd)) }
> ##################################
> # Size Effect
> plot(BAI ~ RelBA, data=results$source_data)
> 
> par(mar=c(5,5,4,2))
> x <- seq(0,1,0.01)
> y <- size.effect(x,results$best_pars$ca, results$best_pars$cb,results$best_pars$cc)
> summary(y)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  1.784   1.784   1.784   4.702   1.784 296.500 
> 
> pdf(file.path("Figures", paste(run.label, " - Competition Size Effect.pdf", sep="")))
> plot(x,y,xlab="Relative Size",ylab="Size Effect",type="l",lwd=2,
+       cex.lab=1.5,cex.axis=1.25,main=run.label)
> #savePlot(file=paste("Competition Plot 1 ",run.label,".png",sep=""),type="png")
> dev.off()
pdf 
  2 
> 
> #####################
> # Plot BA effect
> plot(BAI ~ BA.m2ha.plot, data=results$source_data)
> 
> par(mar=c(5,5,4,2))
> x <- seq(0,60,0.1)
> y <- comp.effect(x, results$best_pars$ce, results$best_pars$cf,results$best_pars$cg)
> summary(y)
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.000000 0.000000 0.007329 0.497200 1.000000 1.000000 
> 
> pdf(file.path("Figures", paste(run.label, " - Competition Competitive Effect.pdf", sep="")))
> plot(x,y,ylim=c(0,1),xlab="Plot BA",ylab="Competitive Effect",type="l",lwd=2,
+        cex.lab=1.5,cex.axis=1.25,main=run.label)
> dev.off()
pdf 
  2 
> #savePlot(file=paste("Competition Plot 2 ",run.label,".png",sep=""),type="png")
> 
> #####################
> # Competition Response: Size vs. Response with different plot BA levels
> plot(BA.m2ha.plot~ RelBA, data=results$source_data)
> 
> 
> pdf(file.path("Figures", paste(run.label, " - Competition Response Scalar.pdf", sep="")))
> par(mar=c(5,5,4,2))
> colors <- c("red","orange","blue","cyan","green")
> x <- seq(0,1,0.01)
> y <- comp.response(SIZE=x, BA.PLOT=50, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> plot(x,y,ylim=c(0,1),xlab="Relative Size",ylab="Competition Scalar",type="l",col=colors[1],lwd=2,
+      cex.lab=1.5,cex.axis=1.25,main=run.label)
> y <- comp.response(SIZE=x, BA.PLOT=40, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[2],lwd=2)
> y <- comp.response(SIZE=x, BA.PLOT=30, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[3],lwd=2)
> y <- comp.response(SIZE=x, BA.PLOT=20, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[4],lwd=2)
> y <- comp.response(SIZE=x, BA.PLOT=10, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[5],lwd=2)
> lines(x,y,col=colors[6],lwd=2)
> legend("bottomright",legend=c(50,40,30,20,10),col=colors,bty="n",lwd=2,title="Plot\nBasal\nArea",cex=1.25)
> dev.off()
pdf 
  2 
> #savePlot(file=paste("Competition Plot 3 ",run.label,".png",sep=""),type="png")
> 
> 
> ##################################
> temp.effect <- function(TEMP,ta1,tb1)
+        { (exp(-0.5*(((TEMP)-ta1)/tb1)^2))  }
> 
> precip.effect <- function(PRECIP,pa1,pb1)
+        { (exp(-0.5*(((PRECIP)-pa1)/pb1)^2)) }
> 
> # precip.effect <- function(PRECIP,pa1,pb1)
>        # { (1/(1+((PRECIP)/pa1)^pb1))  }
> 
> climate.effect <- function(TEMP,PRECIP,ta1,tb1,pa1,pb1)
+        { (exp(-0.5*(((TEMP)-ta1)/tb1)^2)) * (exp(-0.5*(((PRECIP)-pa1)/pb1)^2)) }
> ##################################
> # Temperature
> plot(acru.run$BAI ~ rowMeans(acru.run[,temp.col]), xlab="Mean Temp Mar-Oct", ylab="BAI (mm)")
Error in `[.data.frame`(acru.run, , temp.col) : 
  object 'temp.col' not found
Calls: plot ... eval -> rowMeans -> is.data.frame -> [ -> [.data.frame
Execution halted
