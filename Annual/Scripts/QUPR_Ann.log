
R version 2.15.3 (2013-03-01) -- "Security Blanket"
Copyright (C) 2013 The R Foundation for Statistical Computing
ISBN 3-900051-07-0
Platform: x86_64-unknown-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ####################################################
> # QUPR MODEL Autogenic x Competition x (Temp x Precip) :
> # Autogenic: Size/Age logistic scalar with Max potential growth for absolute values
> # Competition: Relative Size, Plot BA Scalars
> # Climate: Jan-Dec
> #	-- Temp: Mean Jan-Dec, Gaussian
> #	-- Precip: Sum Jan-Dec + upslope flow, Gaussian
> #
> ####################################################
> rm(list=ls())
> 
> data_directory <- "~/CARCA/Growth-Models/Annual/"
> #memory.size(4024)
> setwd(data_directory)
> library(likelihood)
Loading required package: nlme
> 
> # run.label <- "QUPR_Full_Ann"
> # load(file=paste( run.label, "_Results.Rdata", sep=""))
> 
> run.label <- "QUPR_Full_Ann"
> 
> #############
> # Reading in Test Data & some formating
> all.data <-read.csv("../Raw Inputs/CARCA_CoreData_Climate_Annual.csv")
> all.data[,substr(names(all.data),1,4)=="Tavg"] <- all.data[,substr(names(all.data),1,4)=="Tavg"]+273.15
> all.data$BA.tree.cm2 <- all.data$BA.tree/100
> all.data$Site.Trans <- as.factor(substr(all.data$PlotID,1,4))
> summary(all.data)
      Year          PlotID        Site       Trans           Plot      
 Min.   :1771   HNKC2  :  8505   BLD:62694   A: 88452   Min.   :1.000  
 1st Qu.:1831   FLTA1  :  7776   FLT:49329   B: 93798   1st Qu.:1.000  
 Median :1892   HIKA1  :  7290   HIK:48357   C:106434   Median :2.000  
 Mean   :1892   HNKB2  :  7290   HNK:43983              Mean   :2.265  
 3rd Qu.:1953   HNKA3  :  7047   IRN:52245              3rd Qu.:3.000  
 Max.   :2013   BLDA2  :  6804   MOR:32076              Max.   :4.000  
                (Other):243972                                         
     TreeID            BAI                 CoreID       Pith      
 BLDA101:   243   Min.   :    0.00   BLDA101HI:   243   N:211896  
 BLDA102:   243   1st Qu.:   84.36   BLDA102HI:   243   Y: 76788  
 BLDA103:   243   Median :  244.79   BLDA103HI:   243             
 BLDA104:   243   Mean   :  459.83   BLDA104HI:   243             
 BLDA105:   243   3rd Qu.:  589.69   BLDA105HI:   243             
 BLDA106:   243   Max.   :18648.71   BLDA106HI:   243             
 (Other):287226   NA's   :202009     (Other)  :287226             
    Pith.Yr          Inner          Outer      Bark       Use       
 Min.   :1756    Min.   :1762   Min.   :1990   N:  6318   N:  4617  
 1st Qu.:1917    1st Qu.:1923   1st Qu.:2012   Y:282366   Y:284067  
 Median :1933    Median :1938   Median :2012                        
 Mean   :1936    Mean   :1939   Mean   :2012                        
 3rd Qu.:1953    3rd Qu.:1955   3rd Qu.:2012                        
 Max.   :2008    Max.   :2009   Max.   :2013                        
 NA's   :60021                                                      
                        Notes         Pith.offset         Tree      
 poor corr w/ master       :   972   Min.   : 0.00   Min.   : 1.00  
 poor correlation w/ master:   972   1st Qu.: 1.00   1st Qu.:10.00  
 1977 missing              :   486   Median : 2.00   Median :18.50  
 1986 missing              :   486   Mean   : 3.35   Mean   :20.86  
 1999 missing              :   486   3rd Qu.: 5.00   3rd Qu.:30.00  
 (Other)                   : 14094   Max.   :20.00   Max.   :84.00  
 NA's                      :271188   NA's   :60021                  
      Spp              Genus         Canopy         Live       
 ACRU   :71199   Quercus  :111294   C   :148230   DEAD:   243  
 QUPR   :50787   Acer     : 85779   D   :  8748   LIVE:288441  
 QURU   :43740   Nyssa    : 38880   I   : 86022                
 NYSY   :38880   Magnolia : 11421   U   : 45441                
 ACSA   :14580   Betula   :  8262   NA's:   243                
 MAAC   : 9720   Sassafras:  7776                              
 (Other):59778   (Other)  : 25272                              
      Age            BA.m2ha          BAI.filled          BA.tree      
 Min.   :  0.00   Min.   : 0.0000   Min.   :    0.00   Min.   :     0  
 1st Qu.: 19.00   1st Qu.: 0.0000   1st Qu.:    0.00   1st Qu.:     0  
 Median : 40.00   Median : 0.0000   Median :    0.00   Median :     0  
 Mean   : 44.55   Mean   : 0.1771   Mean   :  149.04   Mean   :  6106  
 3rd Qu.: 64.00   3rd Qu.: 0.0615   3rd Qu.:   74.84   3rd Qu.:  2007  
 Max.   :256.00   Max.   :11.8597   Max.   :18648.71   Max.   :462177  
 NA's   :195231   NA's   :1047      NA's   :985        NA's   :1047    
     Stems          Density.Ha     BAI.filled.plot      BA.plot       
 Min.   :0.0000   Min.   : 0.000   Min.   :    0.0   Min.   :    0.0  
 1st Qu.:0.0000   1st Qu.: 0.000   1st Qu.:    0.0   1st Qu.:    0.0  
 Median :0.0000   Median : 0.000   Median :  904.8   Median :  581.2  
 Mean   :0.3191   Mean   : 9.728   Mean   : 3899.5   Mean   : 2063.0  
 3rd Qu.:1.0000   3rd Qu.:31.831   3rd Qu.: 6247.5   3rd Qu.: 2866.9  
 Max.   :1.0000   Max.   :49.736   Max.   :38677.4   Max.   :23212.2  
                                   NA's   :1500      NA's   :1500     
  BA.m2ha.plot     Density.ha.plot     Stems.plot     BAI.m2ha.plot   
 Min.   : 0.0000   Min.   :   0.00   Min.   : 0.000   Min.   :0.0000  
 1st Qu.: 0.0000   1st Qu.:   0.00   1st Qu.: 0.000   1st Qu.:0.0000  
 Median : 0.0705   Median :  63.66   Median : 2.000   Median :0.0274  
 Mean   : 3.4704   Mean   : 268.53   Mean   : 8.898   Mean   :0.1135  
 3rd Qu.: 4.3534   3rd Qu.: 509.30   3rd Qu.:18.000   3rd Qu.:0.1935  
 Max.   :35.8804   Max.   :1432.39   Max.   :45.000   Max.   :1.0485  
 NA's   :1500      NA's   :1500      NA's   :1500     NA's   :1500    
 BA.m2ha.plot.live     RelBA          Site.Trans        Latitude     
 Min.   : 0.000    Min.   :0.00     BLDC   : 23814   Min.   :36.75   
 1st Qu.: 0.000    1st Qu.:0.05     IRNC   : 20898   1st Qu.:37.24   
 Median : 1.116    Median :0.17     HIKC   : 20169   Median :37.91   
 Mean   : 5.122    Mean   :0.30     BLDA   : 19926   Mean   :37.74   
 3rd Qu.: 6.584    3rd Qu.:0.46     BLDB   : 18954   3rd Qu.:38.32   
 Max.   :57.620    Max.   :1.00     IRNB   : 18711   Max.   :38.58   
 NA's   :985       NA's   :199115   (Other):166212   NA's   :153252  
   Longitude           elev             flow             TPI        
 Min.   :-81.31   Min.   : 666.9   Min.   :0.01     Min.   :-0.23   
 1st Qu.:-80.86   1st Qu.: 843.7   1st Qu.:0.01     1st Qu.:-0.10   
 Median :-79.85   Median : 952.4   Median :0.03     Median :-0.03   
 Mean   :-80.10   Mean   : 955.7   Mean   :0.12     Mean   : 0.01   
 3rd Qu.:-79.22   3rd Qu.:1098.3   3rd Qu.:0.06     3rd Qu.: 0.15   
 Max.   :-79.15   Max.   :1256.7   Max.   :1.42     Max.   : 0.30   
 NA's   :153252   NA's   :153252   NA's   :153252   NA's   :153252  
      sol            sol.lag          Anomaly            Tavg       
 Min.   : 90338   Min.   : 90338   Min.   :-1.48    Min.   :277.5   
 1st Qu.: 99340   1st Qu.: 99340   1st Qu.:-0.40    1st Qu.:281.6   
 Median :107050   Median :107050   Median : 0.01    Median :282.8   
 Mean   :110569   Mean   :110569   Mean   : 0.00    Mean   :282.5   
 3rd Qu.:121199   3rd Qu.:121199   3rd Qu.: 0.37    3rd Qu.:283.6   
 Max.   :133748   Max.   :133748   Max.   : 1.31    Max.   :285.8   
 NA's   :153252   NA's   :153252   NA's   :153252   NA's   :153252  
  Precip.PRISM      Tavg.PRISM     Precip.PRISM.sum  BA.tree.cm2     
 Min.   : 41.00   Min.   :281.3    Min.   : 492.0   Min.   :   0.00  
 1st Qu.: 81.45   1st Qu.:282.6    1st Qu.: 977.4   1st Qu.:   0.00  
 Median : 92.11   Median :283.2    Median :1105.4   Median :   0.00  
 Mean   : 93.52   Mean   :283.2    Mean   :1122.2   Mean   :  61.06  
 3rd Qu.:103.05   3rd Qu.:283.8    3rd Qu.:1236.7   3rd Qu.:  20.07  
 Max.   :152.72   Max.   :285.6    Max.   :1832.7   Max.   :4621.77  
 NA's   :154440   NA's   :261360   NA's   :154440   NA's   :1047     
> dim(all.data)
[1] 288684     49
> 
> #############
> # Subsetting just QUPR data
> qupr.all <- all.data[all.data$Spp=="QUPR", ]
> summary(qupr.all)
      Year          PlotID       Site       Trans          Plot      
 Min.   :1771   MORA2  : 3159   BLD: 9963   A:10692   Min.   :1.000  
 1st Qu.:1831   BLDC4  : 2916   FLT:11178   B:20169   1st Qu.:1.000  
 Median :1892   FLTB4  : 2430   HIK: 1215   C:19926   Median :2.000  
 Mean   :1892   MORC1  : 2187   HNK: 8019             Mean   :2.177  
 3rd Qu.:1953   FLTC2  : 1944   IRN: 8505             3rd Qu.:3.000  
 Max.   :2013   HNKA1  : 1944   MOR:11907             Max.   :4.000  
                (Other):36207                                        
     TreeID           BAI                CoreID      Pith         Pith.Yr     
 BLDA303:  243   Min.   :    3.4   BLDA303HI:  243   N:43740   Min.   :1756   
 BLDA335:  243   1st Qu.:  241.2   BLDA335HI:  243   Y: 7047   1st Qu.:1910   
 BLDA337:  243   Median :  454.2   BLDA337HI:  243             Median :1926   
 BLDA424:  243   Mean   :  639.6   BLDA424HI:  243             Mean   :1919   
 BLDA430:  243   3rd Qu.:  825.7   BLDA430HI:  243             3rd Qu.:1933   
 BLDB136:  243   Max.   :18648.7   BLDB136HI:  243             Max.   :1961   
 (Other):49329   NA's   :32590     (Other)  :49329             NA's   :10935  
     Inner          Outer      Bark      Use      
 Min.   :1762   Min.   :2009   N:  729   N:  486  
 1st Qu.:1914   1st Qu.:2012   Y:50058   Y:50301  
 Median :1933   Median :2012                      
 Mean   :1925   Mean   :2012                      
 3rd Qu.:1942   3rd Qu.:2012                      
 Max.   :1976   Max.   :2013                      
                                                  
                               Notes        Pith.offset          Tree      
 poor correlation w/ master       :  486   Min.   : 0.000   Min.   : 1.00  
 2009/2010 tiny                   :  243   1st Qu.: 2.000   1st Qu.:12.00  
 B side is clearer in supression  :  243   Median : 3.000   Median :21.00  
 actually lower; this one measured:  243   Mean   : 4.482   Mean   :22.71  
 break at 1927                    :  243   3rd Qu.: 6.000   3rd Qu.:34.00  
 (Other)                          : 1215   Max.   :20.000   Max.   :65.00  
 NA's                             :48114   NA's   :10935                   
      Spp             Genus        Canopy        Live            Age       
 QUPR   :50787   Quercus :50787   C   :37422   DEAD:    0   Min.   :  0.0  
 ACRU   :    0   Acer    :    0   D   : 3645   LIVE:50787   1st Qu.: 24.0  
 ACSA   :    0   Betula  :    0   I   : 7776                Median : 48.0  
 BELE   :    0   Carya   :    0   U   : 1701                Mean   : 53.1  
 BEPA   :    0   Castanea:    0   NA's:  243                3rd Qu.: 73.0  
 CADE   :    0   Cornus  :    0                             Max.   :256.0  
 (Other):    0   (Other) :    0                             NA's   :30765  
    BA.m2ha          BAI.filled         BA.tree           Stems      
 Min.   : 0.0000   Min.   :    0.0   Min.   :     0   Min.   :0.000  
 1st Qu.: 0.0000   1st Qu.:    0.0   1st Qu.:     0   1st Qu.:0.000  
 Median : 0.0000   Median :    0.0   Median :     0   Median :0.000  
 Mean   : 0.3782   Mean   :  252.8   Mean   : 12156   Mean   :0.392  
 3rd Qu.: 0.3774   3rd Qu.:  335.1   3rd Qu.: 12000   3rd Qu.:1.000  
 Max.   :11.8597   Max.   :18648.7   Max.   :372594   Max.   :1.000  
 NA's   :188       NA's   :163       NA's   :188                     
   Density.Ha    BAI.filled.plot      BA.plot         BA.m2ha.plot   
 Min.   : 0.00   Min.   :    0.0   Min.   :    0.0   Min.   : 0.000  
 1st Qu.: 0.00   1st Qu.:    0.0   1st Qu.:    0.0   1st Qu.: 0.000  
 Median : 0.00   Median :  933.5   Median :  596.5   Median : 0.102  
 Mean   :12.35   Mean   : 3632.0   Mean   : 1923.5   Mean   : 3.704  
 3rd Qu.:31.83   3rd Qu.: 6467.8   3rd Qu.: 2833.2   3rd Qu.: 5.088  
 Max.   :49.74   Max.   :38677.4   Max.   :23212.2   Max.   :35.880  
                 NA's   :420       NA's   :420       NA's   :420     
 Density.ha.plot     Stems.plot    BAI.m2ha.plot    BA.m2ha.plot.live
 Min.   :   0.00   Min.   : 0.00   Min.   :0.0000   Min.   : 0.0000  
 1st Qu.:   0.00   1st Qu.: 0.00   1st Qu.:0.0000   1st Qu.: 0.2116  
 Median :  63.66   Median : 2.00   Median :0.0299   Median : 1.4892  
 Mean   : 267.98   Mean   : 8.57   Mean   :0.1118   Mean   : 5.3008  
 3rd Qu.: 523.44   3rd Qu.:17.00   3rd Qu.:0.2056   3rd Qu.: 7.3824  
 Max.   :1432.39   Max.   :45.00   Max.   :0.8590   Max.   :46.2800  
 NA's   :420       NA's   :420     NA's   :420      NA's   :163      
     RelBA         Site.Trans       Latitude       Longitude     
 Min.   :0.000   BLDC   : 5589   Min.   :36.76   Min.   :-81.31  
 1st Qu.:0.178   FLTB   : 5346   1st Qu.:37.24   1st Qu.:-80.86  
 Median :0.412   IRNB   : 4860   Median :37.72   Median :-80.11  
 Mean   :0.484   MORA   : 4617   Mean   :37.61   Mean   :-80.26  
 3rd Qu.:0.788   FLTC   : 4131   3rd Qu.:37.92   3rd Qu.:-79.84  
 Max.   :1.000   MORC   : 3888   Max.   :38.57   Max.   :-79.15  
 NA's   :31181   (Other):22356   NA's   :26961   NA's   :26961   
      elev             flow            TPI              sol        
 Min.   : 666.9   Min.   :0.006   Min.   :-0.234   Min.   : 90338  
 1st Qu.: 843.7   1st Qu.:0.013   1st Qu.:-0.097   1st Qu.: 96622  
 Median : 885.9   Median :0.034   Median :-0.053   Median :105240  
 Mean   : 915.6   Mean   :0.133   Mean   :-0.015   Mean   :109314  
 3rd Qu.:1005.1   3rd Qu.:0.064   3rd Qu.: 0.070   3rd Qu.:121199  
 Max.   :1173.5   Max.   :1.419   Max.   : 0.300   Max.   :133748  
 NA's   :26961    NA's   :26961   NA's   :26961    NA's   :26961   
    sol.lag          Anomaly            Tavg        Precip.PRISM   
 Min.   : 90338   Min.   :-1.477   Min.   :277.5   Min.   : 41.00  
 1st Qu.: 96622   1st Qu.:-0.398   1st Qu.:281.4   1st Qu.: 82.15  
 Median :105240   Median : 0.009   Median :282.7   Median : 92.58  
 Mean   :109314   Mean   :-0.003   Mean   :282.4   Mean   : 93.74  
 3rd Qu.:121199   3rd Qu.: 0.369   3rd Qu.:283.7   3rd Qu.:103.05  
 Max.   :133748   Max.   : 1.308   Max.   :285.7   Max.   :152.72  
 NA's   :26961    NA's   :26961    NA's   :26961   NA's   :27170   
   Tavg.PRISM    Precip.PRISM.sum  BA.tree.cm2    
 Min.   :281.3   Min.   : 492.0   Min.   :   0.0  
 1st Qu.:282.9   1st Qu.: 985.8   1st Qu.:   0.0  
 Median :283.4   Median :1110.9   Median :   0.0  
 Mean   :283.4   Mean   :1124.8   Mean   : 121.6  
 3rd Qu.:283.9   3rd Qu.:1236.7   3rd Qu.: 120.0  
 Max.   :285.6   Max.   :1832.7   Max.   :3725.9  
 NA's   :45980   NA's   :27170    NA's   :188     
> dim(qupr.all)
[1] 50787    49
> 
> # Subsetting only complete cases & a small range of years
> qupr.run <- qupr.all[complete.cases(qupr.all) & qupr.all$Year>=1990 & qupr.all$Year<=2011,]
> summary(qupr.run)
      Year          PlotID    Site    Trans       Plot           TreeID  
 Min.   :1990   MORB2  :44   BLD:41   A:44   Min.   :1.000   BLDB237:22  
 1st Qu.:1995   BLDB2  :22   FLT: 0   B:88   1st Qu.:1.000   HNKA113:22  
 Median :2000   HNKA1  :22   HIK: 0   C:41   Median :1.000   IRNB131:22  
 Mean   :2000   IRNB1  :22   HNK:22          Mean   :1.711   IRNC125:22  
 3rd Qu.:2006   IRNC1  :22   IRN:44          3rd Qu.:2.000   MORA118:22  
 Max.   :2011   MORA1  :22   MOR:66          Max.   :4.000   MORB206:22  
                (Other):19                                   (Other):41  
      BAI                CoreID   Pith       Pith.Yr         Inner     
 Min.   :  17.23   BLDB237HI:22   N:129   Min.   :1845   Min.   :1865  
 1st Qu.:  65.44   HNKA113HI:22   Y: 44   1st Qu.:1908   1st Qu.:1911  
 Median : 282.27   IRNB131HI:22           Median :1910   Median :1912  
 Mean   : 636.26   IRNC125HI:22           Mean   :1915   Mean   :1920  
 3rd Qu.:1103.34   MORA118HI:22           3rd Qu.:1953   3rd Qu.:1954  
 Max.   :2904.04   MORB206HI:22           Max.   :1955   Max.   :1958  
                   (Other)  :41                                        
     Outer      Bark    Use                                   Notes   
 Min.   :2009   N:  0   N: 44   poor correlation w/ master       :44  
 1st Qu.:2012   Y:173   Y:129   B side is clearer in supression  :22  
 Median :2012                   actually lower; this one measured:22  
 Mean   :2012                   break at 1927                    :22  
 3rd Qu.:2012                   false rings (2) in 1953          :22  
 Max.   :2012                   lots of error on pith est        :22  
                                (Other)                          :19  
  Pith.offset          Tree            Spp           Genus     Canopy
 Min.   : 1.000   Min.   : 6.00   QUPR   :173   Quercus :173   C:88  
 1st Qu.: 1.000   1st Qu.:13.00   ACRU   :  0   Acer    :  0   D:22  
 Median : 3.000   Median :18.00   ACSA   :  0   Betula  :  0   I:19  
 Mean   : 4.543   Mean   :22.38   BELE   :  0   Carya   :  0   U:44  
 3rd Qu.: 4.000   3rd Qu.:31.00   BEPA   :  0   Castanea:  0         
 Max.   :20.000   Max.   :37.00   CADE   :  0   Cornus  :  0         
                                  (Other):  0   (Other) :  0         
   Live          Age            BA.m2ha          BAI.filled     
 DEAD:  0   Min.   : 35.00   Min.   :0.07544   Min.   :  17.23  
 LIVE:173   1st Qu.: 58.00   1st Qu.:0.17669   1st Qu.:  65.44  
            Median : 86.00   Median :0.41480   Median : 282.27  
            Mean   : 85.12   Mean   :1.15313   Mean   : 636.26  
            3rd Qu.: 96.00   3rd Qu.:1.90412   3rd Qu.:1103.34  
            Max.   :166.00   Max.   :4.58842   Max.   :2904.04  
                                                                
    BA.tree           Stems     Density.Ha    BAI.filled.plot    BA.plot     
 Min.   :  2370   Min.   :1   Min.   :31.83   Min.   : 5584   Min.   : 4765  
 1st Qu.:  5551   1st Qu.:1   1st Qu.:31.83   1st Qu.: 8354   1st Qu.: 6852  
 Median : 13032   Median :1   Median :31.83   Median :10503   Median : 8343  
 Mean   : 36228   Mean   :1   Mean   :31.83   Mean   :11885   Mean   : 8739  
 3rd Qu.: 59822   3rd Qu.:1   3rd Qu.:31.83   3rd Qu.:15071   3rd Qu.: 9955  
 Max.   :144154   Max.   :1   Max.   :31.83   Max.   :26987   Max.   :16266  
                                                                             
  BA.m2ha.plot    Density.ha.plot    Stems.plot    BAI.m2ha.plot   
 Min.   : 7.755   Min.   : 509.3   Min.   :16.00   Min.   :0.1777  
 1st Qu.:10.746   1st Qu.: 732.1   1st Qu.:23.00   1st Qu.:0.2659  
 Median :16.464   Median : 795.8   Median :25.00   Median :0.3343  
 Mean   :16.640   Mean   : 904.9   Mean   :28.43   Mean   :0.3783  
 3rd Qu.:21.215   3rd Qu.:1145.9   3rd Qu.:36.00   3rd Qu.:0.4797  
 Max.   :30.972   Max.   :1336.9   Max.   :42.00   Max.   :0.8590  
                                                                   
 BA.m2ha.plot.live     RelBA           Site.Trans    Latitude    
 Min.   :14.51     Min.   :0.01094   MORB   :44   Min.   :36.76  
 1st Qu.:17.86     1st Qu.:0.06445   BLDB   :22   1st Qu.:36.76  
 Median :21.79     Median :0.17326   HNKA   :22   Median :37.72  
 Mean   :23.04     Mean   :0.34755   IRNB   :22   Mean   :37.60  
 3rd Qu.:28.01     3rd Qu.:0.71314   IRNC   :22   3rd Qu.:37.92  
 Max.   :35.43     Max.   :1.00000   MORA   :22   Max.   :38.32  
                                     (Other):19                  
   Longitude           elev             flow               TPI          
 Min.   :-81.31   Min.   : 744.2   Min.   :0.007794   Min.   :-0.19670  
 1st Qu.:-81.31   1st Qu.: 744.2   1st Qu.:0.008083   1st Qu.:-0.11032  
 Median :-80.11   Median : 941.8   Median :0.034883   Median :-0.09616  
 Mean   :-80.24   Mean   : 911.8   Mean   :0.081560   Mean   :-0.03782  
 3rd Qu.:-79.84   3rd Qu.:1000.5   3rd Qu.:0.224870   3rd Qu.: 0.18194  
 Max.   :-79.24   Max.   :1114.8   Max.   :0.224870   Max.   : 0.19766  
                                                                        
      sol            sol.lag          Anomaly             Tavg      
 Min.   : 90798   Min.   : 90798   Min.   :-0.7818   Min.   :278.5  
 1st Qu.: 90798   1st Qu.: 90798   1st Qu.:-0.3248   1st Qu.:280.7  
 Median : 98239   Median : 98239   Median : 0.1238   Median :281.8  
 Mean   :102684   Mean   :102684   Mean   : 0.1041   Mean   :281.9  
 3rd Qu.:110253   3rd Qu.:110253   3rd Qu.: 0.4871   3rd Qu.:283.3  
 Max.   :119732   Max.   :119732   Max.   : 1.1212   Max.   :285.1  
                                                                    
  Precip.PRISM      Tavg.PRISM    Precip.PRISM.sum  BA.tree.cm2     
 Min.   : 67.63   Min.   :281.7   Min.   : 811.6   Min.   :  23.70  
 1st Qu.: 85.25   1st Qu.:282.8   1st Qu.:1023.0   1st Qu.:  55.51  
 Median : 93.05   Median :283.4   Median :1116.6   Median : 130.32  
 Mean   : 95.72   Mean   :283.4   Mean   :1148.7   Mean   : 362.28  
 3rd Qu.:105.35   3rd Qu.:283.9   3rd Qu.:1264.2   3rd Qu.: 598.22  
 Max.   :135.49   Max.   :285.0   Max.   :1625.9   Max.   :1441.54  
                                                                    
> dim(qupr.run)
[1] 173  49
> 
> write.csv(qupr.run, "Inputs/QUPR_AllSites_1990-2011.csv", row.names=F)
> 
> ################################################
> # Reading in Data
> qupr.run <- read.csv("Inputs/QUPR_AllSites_1990-2011.csv")
> summary(qupr.run)
      Year        PlotID    Site    Trans       Plot           TreeID  
 Min.   :1990   BLDB2:22   BLD:41   A:44   Min.   :1.000   BLDB237:22  
 1st Qu.:1995   BLDC4:19   HNK:22   B:88   1st Qu.:1.000   HNKA113:22  
 Median :2000   HNKA1:22   IRN:44   C:41   Median :1.000   IRNB131:22  
 Mean   :2000   IRNB1:22   MOR:66          Mean   :1.711   IRNC125:22  
 3rd Qu.:2006   IRNC1:22                   3rd Qu.:2.000   MORA118:22  
 Max.   :2011   MORA1:22                   Max.   :4.000   MORB206:22  
                MORB2:44                                   (Other):41  
      BAI                CoreID   Pith       Pith.Yr         Inner     
 Min.   :  17.23   BLDB237HI:22   N:129   Min.   :1845   Min.   :1865  
 1st Qu.:  65.44   HNKA113HI:22   Y: 44   1st Qu.:1908   1st Qu.:1911  
 Median : 282.27   IRNB131HI:22           Median :1910   Median :1912  
 Mean   : 636.26   IRNC125HI:22           Mean   :1915   Mean   :1920  
 3rd Qu.:1103.34   MORA118HI:22           3rd Qu.:1953   3rd Qu.:1954  
 Max.   :2904.04   MORB206HI:22           Max.   :1955   Max.   :1958  
                   (Other)  :41                                        
     Outer      Bark    Use                                   Notes   
 Min.   :2009   Y:173   N: 44   B side is clearer in supression  :22  
 1st Qu.:2012           Y:129   actually lower; this one measured:22  
 Median :2012                   break at 1927                    :22  
 Mean   :2012                   dead or broken outside           :19  
 3rd Qu.:2012                   false rings (2) in 1953          :22  
 Max.   :2012                   lots of error on pith est        :22  
                                poor correlation w/ master       :44  
  Pith.offset          Tree         Spp          Genus     Canopy   Live    
 Min.   : 1.000   Min.   : 6.00   QUPR:173   Quercus:173   C:88   LIVE:173  
 1st Qu.: 1.000   1st Qu.:13.00                            D:22             
 Median : 3.000   Median :18.00                            I:19             
 Mean   : 4.543   Mean   :22.38                            U:44             
 3rd Qu.: 4.000   3rd Qu.:31.00                                             
 Max.   :20.000   Max.   :37.00                                             
                                                                            
      Age            BA.m2ha          BAI.filled         BA.tree      
 Min.   : 35.00   Min.   :0.07544   Min.   :  17.23   Min.   :  2370  
 1st Qu.: 58.00   1st Qu.:0.17669   1st Qu.:  65.44   1st Qu.:  5551  
 Median : 86.00   Median :0.41480   Median : 282.27   Median : 13032  
 Mean   : 85.12   Mean   :1.15313   Mean   : 636.26   Mean   : 36228  
 3rd Qu.: 96.00   3rd Qu.:1.90412   3rd Qu.:1103.34   3rd Qu.: 59822  
 Max.   :166.00   Max.   :4.58842   Max.   :2904.04   Max.   :144154  
                                                                      
     Stems     Density.Ha    BAI.filled.plot    BA.plot       BA.m2ha.plot   
 Min.   :1   Min.   :31.83   Min.   : 5584   Min.   : 4765   Min.   : 7.755  
 1st Qu.:1   1st Qu.:31.83   1st Qu.: 8354   1st Qu.: 6852   1st Qu.:10.746  
 Median :1   Median :31.83   Median :10503   Median : 8343   Median :16.464  
 Mean   :1   Mean   :31.83   Mean   :11885   Mean   : 8739   Mean   :16.640  
 3rd Qu.:1   3rd Qu.:31.83   3rd Qu.:15071   3rd Qu.: 9955   3rd Qu.:21.215  
 Max.   :1   Max.   :31.83   Max.   :26987   Max.   :16266   Max.   :30.972  
                                                                             
 Density.ha.plot    Stems.plot    BAI.m2ha.plot    BA.m2ha.plot.live
 Min.   : 509.3   Min.   :16.00   Min.   :0.1777   Min.   :14.51    
 1st Qu.: 732.1   1st Qu.:23.00   1st Qu.:0.2659   1st Qu.:17.86    
 Median : 795.8   Median :25.00   Median :0.3343   Median :21.79    
 Mean   : 904.9   Mean   :28.43   Mean   :0.3783   Mean   :23.04    
 3rd Qu.:1145.9   3rd Qu.:36.00   3rd Qu.:0.4797   3rd Qu.:28.01    
 Max.   :1336.9   Max.   :42.00   Max.   :0.8590   Max.   :35.43    
                                                                    
     RelBA         Site.Trans    Latitude       Longitude           elev       
 Min.   :0.01094   BLDB:22    Min.   :36.76   Min.   :-81.31   Min.   : 744.2  
 1st Qu.:0.06445   BLDC:19    1st Qu.:36.76   1st Qu.:-81.31   1st Qu.: 744.2  
 Median :0.17326   HNKA:22    Median :37.72   Median :-80.11   Median : 941.8  
 Mean   :0.34755   IRNB:22    Mean   :37.60   Mean   :-80.24   Mean   : 911.8  
 3rd Qu.:0.71314   IRNC:22    3rd Qu.:37.92   3rd Qu.:-79.84   3rd Qu.:1000.5  
 Max.   :1.00000   MORA:22    Max.   :38.32   Max.   :-79.24   Max.   :1114.8  
                   MORB:44                                                     
      flow               TPI                sol            sol.lag      
 Min.   :0.007794   Min.   :-0.19670   Min.   : 90798   Min.   : 90798  
 1st Qu.:0.008083   1st Qu.:-0.11032   1st Qu.: 90798   1st Qu.: 90798  
 Median :0.034883   Median :-0.09616   Median : 98239   Median : 98239  
 Mean   :0.081560   Mean   :-0.03782   Mean   :102684   Mean   :102684  
 3rd Qu.:0.224870   3rd Qu.: 0.18194   3rd Qu.:110253   3rd Qu.:110253  
 Max.   :0.224870   Max.   : 0.19766   Max.   :119732   Max.   :119732  
                                                                        
    Anomaly             Tavg        Precip.PRISM      Tavg.PRISM   
 Min.   :-0.7818   Min.   :278.5   Min.   : 67.63   Min.   :281.7  
 1st Qu.:-0.3248   1st Qu.:280.7   1st Qu.: 85.25   1st Qu.:282.8  
 Median : 0.1238   Median :281.8   Median : 93.05   Median :283.4  
 Mean   : 0.1041   Mean   :281.9   Mean   : 95.72   Mean   :283.4  
 3rd Qu.: 0.4871   3rd Qu.:283.3   3rd Qu.:105.35   3rd Qu.:283.9  
 Max.   : 1.1212   Max.   :285.1   Max.   :135.49   Max.   :285.0  
                                                                   
 Precip.PRISM.sum  BA.tree.cm2     
 Min.   : 811.6   Min.   :  23.70  
 1st Qu.:1023.0   1st Qu.:  55.51  
 Median :1116.6   Median : 130.32  
 Mean   :1148.7   Mean   : 362.28  
 3rd Qu.:1264.2   3rd Qu.: 598.22  
 Max.   :1625.9   Max.   :1441.54  
                                   
> 
> # Loading previous runs
> #load(file="Test results for QUPR 4 - All Sites 1990-2011.Rdata")
> 
> ####################################################################################################################
> overall.model <- function(
+ 							SIZE,aa,ab, gmax,             # Autogenic (a) -- ABSOLUTE UNITS (from gmax)
+                             BA.PLOT,RS,ca,cb,cc,cd,ce,cf,cg, # Competition (c) -- scalar
+                             # # BA.PLOT,RS,ca,cb,cc,cd,cf,cg, # Competition (c) -- scalar, removed intercept
+                             TEMP,ta1,tb1,					 # Temperature (t) -- scalar
+                             PRECIP,FLOW,pa1,pb1,pc1         	 # Preciptiation (p) -- scalar
+                             # TRANS, ha		             	 # Habitat (h) -- scalar
+                             )
+ 	{
+ 	################
+ 	# Autogenic Growth: 0-1 * gmax (max possible growth, absolute units)
+ 	################
+ 	autogenic.effect <- gmax*(1 - aa*exp(-ab*SIZE))   
+ 	# autogenic.effect <- gmax*(1-aa*exp(-ab*SIZE))   
+ 
+ 
+ 	################
+ 	# Competition Effect: 0-1 
+ 	################
+ 	size.effect <- ca*exp(-cb*(RS^cc))
+ 	comp.effect <- (ce/1000 + ( (1-ce/1000)/(1+(BA.PLOT/cf)^cg)))
+ 	# comp.effect <- (1/(1+(BA.PLOT/cf)^cg))
+ 	comp.response <- exp(-size.effect*(comp.effect^cd))
+ 
+  	################
+ 	# Climate Effect: Now Scalar
+ 	################
+ 	
+ 	#Temp on scale 0-1
+     temp.effect <- (exp(-0.5*(((TEMP)-ta1)/tb1)^2))
+ 
+     # Precip on scale 0-1
+     # precip.effect <- t(1/(1+(t(PRECIP)/pa1)^pb1))
+ 	precip.effect <- (exp(-0.5*(((PRECIP + pc1*FLOW*PRECIP)-pa1)/pb1)^2)) # Gaussian Data Frame
+ 
+ 	# Multiplying temp & precip together
+     climate.effect <- temp.effect * precip.effect
+ 	 
+ 	 ### LEM: do row sums
+ 	 ##### CRR note: I think this should be on a scale from 0-1; 
+      # climate.effect <- colSums(climate.effect) 
+ 	 # climate.effect2 <- apply(climate.effect, 1, FUN=prod)
+ 	
+ 
+ 	################
+ 	# Habitat Effect: 0-1
+ 	# Note: removed from model for the moment, may add Topographic position or upslope area later
+ 	################
+ 	# habitat.effect <- ha[TRANS]
+ 
+ 	# comp.response <- 1
+ 	habitat.effect <- 1
+ 	# climate.effect2 <- precip.effect
+ 
+ 	autogenic.effect*comp.response*habitat.effect*climate.effect
+ 	
+ 
+ 	}
> 
> 
> ####################################################################################################################
> ####################################################################################################################
> ### setting up annealing
> 
> # par <- results$best_par
> 
> # need a list that gives initial values for all of the "parameters"
> par<-list(
+ 		  aa=0.93, ab=0.0002, gmax=10000,  	# Autogenic
+           ca=9.6, cb=379, cc=2.74, cd=4.3, ce=175, cf=1513, cg=12.6,  # Competition
+           ta1=314.5, tb1=39.2,
+           pa1=1133, pb1=438, pc1=0.16,
+           # # ha=rep(0.5,3),  # Habitat
+           sd=262)
> 
> # also need a list that identifies the independent variables
> var <- list(SIZE = "BA.tree.cm2",  # Autogenic
+             BA.PLOT="BA.m2ha.plot.live", RS="RelBA",  # Competition
+             TEMP = "Tavg", # hard-coded above
+             PRECIP = "Precip.PRISM.sum", FLOW="flow"
+             # TRANS="Site.Trans" # Habitat
+             )
> 
> ## Set bounds and initial search ranges within which to search for parameters
> ##   NOTE:  the s and sd parameters have to be greater than zero (algebraically)
> par_lo <-list(
+ 			  aa=0, ab=0, gmax=0,  # Autogenic
+               ca=0, cb=0, cc=0, cd=0, ce=0, cf=-100, cg=-1000, # Competition
+               # # ca=0, cb=0, cc=0, cd=0, cf=-100, cg=-200, # Competition
+               ta1=250, tb1=0,
+               pa1=100, pb1=0, pc1=0,
+ 			# ha=rep(0,3), # Habitat
+               sd=0.1)
> 
> 
> par_hi <-list(
+ 			  aa=1, ab=1000, gmax=10000, # Autogenic
+               ca=2000, cb=1000, cc=5, cd=5, ce=1000, cf=2000, cg=1000,	# Competition
+               # # ca=1000, cb=1000, cc=50, cd=5, cf=500, cg=1000,	# Competition
+               ta1=325, tb1=500,
+               pa1=5000, pb1=10000, pc1=1,
+               # ha=rep(1,3), # Habitat
+               sd=1000)
> 
> ## Specify the dependent variable, and name it using whatever
> ##    argument name is used in the pdf ("x" in the normal.pdf function above)
> var$x<-"BAI"
> 
> ## predicted value in your PDF should be given the reserved name "predicted"
> ##   Anneal will use your scientific model and your data and calculate the
> ##   predicted value for each observation and store it internally in an object
> ##   called "predicted"
> var$mean<-"predicted"
> 
> ## Have it calculate log likelihood
> var$log<-TRUE
> 
> ##  now call the annealing algorithm, choosing which model to use
> #  "data" should be whatever the name of your dataframe is...
> results <- anneal(overall.model, par, var, qupr.run, par_lo, par_hi, dnorm, "BAI", hessian = T, slimit=1.92, max_iter=100000)
> 
> save(results,file=file.path("Outputs", paste(run.label, "_Results.Rdata", sep="")))
> 
> write_results(results,file.path("Outputs", paste(run.label, "_Results.txt", sep="")))
> 
> ## display some of the results in the console
> results$best_pars;
$aa
[1] 0.9299298

$ab
[1] 0.0001404305

$gmax
[1] 9361.634

$ca
[1] 4.223065

$cb
[1] 999.1505

$cc
[1] 3.5411

$cd
[1] 2.734101

$ce
[1] 814.3283

$cf
[1] 295.0111

$cg
[1] 350.3588

$ta1
[1] 286.7844

$tb1
[1] 12.79626

$pa1
[1] 1145.426

$pb1
[1] 422.2853

$pc1
[1] 0.0003300321

$sd
[1] 242.562

> results$max_likeli;
[1] -1196.509
> results$aic_corr ;
[1] 2428.506
> results$slope;
[1] 1.000467
> results$R2
[1] 0.8773504
> 
> ####################################################################################################################
> ####################################################################################################################
> load(file=file.path("Outputs", paste(run.label, "_Results.Rdata", sep="")))
> 
> 
> # Looking at Residuals and Parameters
> #windows()
> plot(results$source_data$predicted,results$source_data$BAI,xlab="Predicted",ylab="Observed")
> abline(0,1,lwd=2,col="red")
> 
> results$source_data$residual <- results$source_data$BAI - results$source_data$predicted
> #windows()
> hist(results$source_data$residual)
> 
> 
> ##################################
> autogenic.effect <- function(SIZE,aa,ab) { (1 - aa*exp(-ab*SIZE))  }
> ##################################
> plot(BAI ~ BA.tree.cm2, data=results$source_data)
> plot(BAI ~ Age, data=results$source_data)
> plot(BA.tree.cm2 ~ Age, data=results$source_data)
> 
> summary(results$source_data$BA.tree.cm2)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  23.70   55.51  130.30  362.30  598.20 1442.00 
> summary(results$source_data$Age)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  35.00   58.00   86.00   85.12   96.00  166.00 
> 
> # Effect of Tree Basal Area
> #windows()
> par(mar=c(5,5,4,2), mfrow=c(1,1))
> x <- seq(0,max(ceiling(results$source_data$BA.tree.cm2)),1)
> y <- autogenic.effect(x,results$best_pars$aa,results$best_pars$ab)
> 
> pdf(file.path("Figures", paste(run.label, " - Autogenic Scalar.pdf", sep="")))
> plot(x,y,ylim=c(0,1),xlab="Tree Basal Area (cm2)",ylab="Effect of Size on Growth",
+      cex.axis=1.25,cex.lab=1.5,type="l",lwd=2,main=run.label)
> dev.off()
pdf 
  2 
> 
> 
> #################################
> size.effect <- function(SIZE,ca,cb,cc) {ca*exp(-cb*(SIZE^cc))}
> comp.effect <- function(BA.PLOT,ce,cf,cg) {ce/1000 + ( (1-ce/1000)/(1+(BA.PLOT/cf)^cg))}
> comp.response <- function(SIZE,BA.PLOT,ca,cb,cc,cd,ce,cf,cg)
+   { size.effect <- ca*exp(-cb*(SIZE^cc))
+     comp.effect <- (ce/1000 + ( (1-ce/1000)/(1+(BA.PLOT/cf)^cg)))
+     comp.response <- exp(-size.effect*(comp.effect^cd)) }
> ##################################
> # Size Effect
> plot(BAI ~ RelBA, data=results$source_data)
> 
> par(mar=c(5,5,4,2))
> x <- seq(0,1,0.01)
> y <- size.effect(x,results$best_pars$ca, results$best_pars$cb,results$best_pars$cc)
> summary(y)
    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
0.000000 0.000000 0.000000 0.556200 0.002651 4.223000 
> 
> pdf(file.path("Figures", paste(run.label, " - Competition Size Effect.pdf", sep="")))
> plot(x,y,xlab="Relative Size",ylab="Size Effect",type="l",lwd=2,
+       cex.lab=1.5,cex.axis=1.25,main=run.label)
> #savePlot(file=paste("Competition Plot 1 ",run.label,".png",sep=""),type="png")
> dev.off()
pdf 
  2 
> 
> #####################
> # Plot BA effect
> plot(BAI ~ BA.m2ha.plot, data=results$source_data)
> 
> par(mar=c(5,5,4,2))
> x <- seq(0,60,0.1)
> y <- comp.effect(x, results$best_pars$ce, results$best_pars$cf,results$best_pars$cg)
> summary(y)
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      1       1       1       1       1       1 
> 
> pdf(file.path("Figures", paste(run.label, " - Competition Competitive Effect.pdf", sep="")))
> plot(x,y,ylim=c(0,1),xlab="Plot BA",ylab="Competitive Effect",type="l",lwd=2,
+        cex.lab=1.5,cex.axis=1.25,main=run.label)
> dev.off()
pdf 
  2 
> #savePlot(file=paste("Competition Plot 2 ",run.label,".png",sep=""),type="png")
> 
> #####################
> # Competition Response: Size vs. Response with different plot BA levels
> plot(BA.m2ha.plot~ RelBA, data=results$source_data)
> 
> 
> pdf(file.path("Figures", paste(run.label, " - Competition Response Scalar.pdf", sep="")))
> par(mar=c(5,5,4,2))
> colors <- c("red","orange","blue","cyan","green")
> x <- seq(0,1,0.01)
> y <- comp.response(SIZE=x, BA.PLOT=50, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> plot(x,y,ylim=c(0,1),xlab="Relative Size",ylab="Competition Scalar",type="l",col=colors[1],lwd=2,
+      cex.lab=1.5,cex.axis=1.25,main=run.label)
> y <- comp.response(SIZE=x, BA.PLOT=40, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[2],lwd=2)
> y <- comp.response(SIZE=x, BA.PLOT=30, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[3],lwd=2)
> y <- comp.response(SIZE=x, BA.PLOT=20, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[4],lwd=2)
> y <- comp.response(SIZE=x, BA.PLOT=10, results$best_pars$ca, results$best_pars$cb, results$best_pars$cc, results$best_pars$cd, results$best_pars$ce, results$best_pars$cf, results$best_pars$cg)
> lines(x,y,col=colors[5],lwd=2)
> lines(x,y,col=colors[6],lwd=2)
> legend("bottomright",legend=c(50,40,30,20,10),col=colors,bty="n",lwd=2,title="Plot\nBasal\nArea",cex=1.25)
> dev.off()
pdf 
  2 
> #savePlot(file=paste("Competition Plot 3 ",run.label,".png",sep=""),type="png")
> 
> 
> ##################################
> temp.effect <- function(TEMP,ta1,tb1)
+        { (exp(-0.5*(((TEMP)-ta1)/tb1)^2))  }
> 
> precip.effect <- function(PRECIP,pa1,pb1)
+        { (exp(-0.5*(((PRECIP)-pa1)/pb1)^2)) }
> 
> # precip.effect <- function(PRECIP,pa1,pb1)
>        # { (1/(1+((PRECIP)/pa1)^pb1))  }
> 
> climate.effect <- function(TEMP,PRECIP,ta1,tb1,pa1,pb1)
+        { (exp(-0.5*(((TEMP)-ta1)/tb1)^2)) * (exp(-0.5*(((PRECIP)-pa1)/pb1)^2)) }
> ##################################
> # Temperature
> plot(qupr.run$BAI ~ rowMeans(qupr.run[,temp.col]), xlab="Mean Temp Mar-Oct", ylab="BAI (mm)")
Error in `[.data.frame`(qupr.run, , temp.col) : 
  object 'temp.col' not found
Calls: plot ... eval -> rowMeans -> is.data.frame -> [ -> [.data.frame
Execution halted
